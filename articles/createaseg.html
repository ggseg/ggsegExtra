<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example creation: the aseg subcortical atlas • ggsegExtra</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example creation: the aseg subcortical atlas">
<meta property="og:description" content="ggsegExtra">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggsegExtra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggsegExtra.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/createaseg.html">Example creation: the aseg subcortical atlas</a>
    </li>
    <li>
      <a href="../articles/createdkt.html">Example creation: the DKT cortical atlas</a>
    </li>
    <li>
      <a href="../articles/customatlas.html">Contributing: creating new polygon ggseg-atlases</a>
    </li>
    <li>
      <a href="../articles/customatlas3d.html">Contributing: creating new tridimensional ggseg3d-atlases</a>
    </li>
    <li>
      <a href="../articles/ggsegrepo.html">Contributing: prepare a repository for the atlas</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/LCBC-UiO/ggsegExtra/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="createaseg_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="createaseg_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="createaseg_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example creation: the aseg subcortical atlas</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LCBC-UiO/ggsegExtra/blob/master/vignettes/createaseg.Rmd"><code>vignettes/createaseg.Rmd</code></a></small>
      <div class="hidden name"><code>createaseg.Rmd</code></div>

    </div>

    
    
<p>Here we provide an example of creating a cortical ggseg and ggseg3d atlas. To read more about the details of the process, see the vignette on <a href="customatlas3d.html">creating custom3d atlases</a> and <a href="customatlas.html">creating custom polygon atlases</a>.</p>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>To successfully run these operations, you must have the following installed on your system, and be running it on either a Linux or Mac.<br>
- <a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/">FSL</a><br>
- <a href="https://surfer.nmr.mgh.harvard.edu/">FreeSurfer</a><br>
- <a href="https://www.r-project.org/">R</a><br>
- <a href="https://imagemagick.org/index.php">Imagemagick</a><br>
- <a href="https://github.com/plotly/orca">orca</a></p>
<p>Initiate your R script with the following library calls:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LCBC-UiO/ggsegExtra">ggsegExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LCBC-UiO/ggseg">ggseg</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LCBC-UiO/ggseg3d">ggseg3d</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span> <span class="co"># for cleaning the atlas data efficiently</span></code></pre></div>
</div>
<div id="creating-a-3d-atlas" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-3d-atlas" class="anchor"></a>Creating a 3d atlas</h2>
<div id="the-template-file" class="section level3">
<h3 class="hasAnchor">
<a href="#the-template-file" class="anchor"></a>The template file</h3>
<p>Subcortical segmentations are usually stored in volumetric images with <code>.mgz</code> extension. These usually also include the cortex, white matter and CSF. Some volumetric segmentations may contain both segmentations of the cortex and the subcortex. If you have such a template, we would recommend making a version where the cortex is one large segmentation, and rather create a separate cortical atlas.</p>
</div>
<div id="the-3d-atlas" class="section level3">
<h3 class="hasAnchor">
<a href="#the-3d-atlas" class="anchor"></a>The 3d atlas</h3>
<p>We assume the volumetric image you have is for a freesurfer subject, specifically registered to the “fsaverage5” subject, which is a good balande between number of vertices and details. If you need to register the volume to “fsaverage5”, there are FreeSurfer tools to help with this, but we have not set up any function for this in R. If you have suggestions or know of an easy command to do this, les ut know in the <a href="https://github.com/LCBC-UiO/ggsegExtra/issues">issues</a> so we can try implementing your solution here.</p>
<p>To turn a volumetric image to a ggseg3d-atlas, use the function <code>make_volumetric_2_3datlas</code>. This will call a series of FreeSurfer functions to create ascii and ply files for the mesh plots. The function creates several intermediary files which are saved in the output_dir specified.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make  3d ----</span>
<span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_volumetric_2_3datlas.html">make_volumetric_2_3datlas</a></span><span class="op">(</span>
  subject <span class="op">=</span> <span class="st">"fsaverage5"</span>,
  subjects_dir <span class="op">=</span> <span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_subj_dir.html">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>,
  template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_subj_dir.html">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5/mri/aseg.mgz"</span><span class="op">)</span>,
  output_dir <span class="op">=</span> <span class="st">"~/Desktop/aseg"</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span></code></pre></div>
<p><img src="figures/aseg_raw.png"><!-- --></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aseg2_3d</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># A tibble: 1 x 4</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  atlas   surf  hemi              ggseg_3d</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>list<span class="op">&lt;</span>tbl_df[,<span class="dv">5</span>]<span class="op">&gt;</span><span class="er">&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="dv">1</span> aseg_3d LCBC  subcort           [<span class="dv">43</span> × <span class="dv">5</span>]</span></code></pre></div>
</div>
<div id="cleaning-the-atlas-data" class="section level3">
<h3 class="hasAnchor">
<a href="#cleaning-the-atlas-data" class="anchor"></a>Cleaning the atlas data</h3>
<p>The atlas data usually needs some manual editing to get it into a nice shape for other users, and for nice plotting. We are avid <a href="https://www.tidyverse.org/">tidyverse</a> users, and as such the procedures we use here to clean the data use tidyverse functions.</p>
<p>First, we will unnest the <code>ggseg_3d</code> column, so we can see what the atlas data contains.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># A tibble: 43 x 8</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>   atlas   surf  hemi    region                       colour  label                        roi   mesh            </span>
<span id="cb7-3"><a href="#cb7-3"></a>   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                        </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                        </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>list<span class="op">&gt;</span><span class="st">          </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st"> </span><span class="dv">1</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Cerebral<span class="op">-</span>White<span class="op">-</span>Matter   <span class="co">#F5F5F5 Left-Cerebral-White-Matter   0002  &lt;named list [2]&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a> <span class="dv">2</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Cerebral<span class="op">-</span>Cortex         <span class="co">#CD3E4E Left-Cerebral-Cortex         0003  &lt;named list [2]&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a> <span class="dv">3</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Lateral<span class="op">-</span>Ventricle       <span class="co">#781286 Left-Lateral-Ventricle       0004  &lt;named list [2]&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a> <span class="dv">4</span> aseg_3d LCBC  subcort Left<span class="op">-</span><span class="ot">Inf</span><span class="op">-</span>Lat<span class="op">-</span>Vent            <span class="co">#C43AFA Left-Inf-Lat-Vent            0005  &lt;named list [2]&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8"></a> <span class="dv">5</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Cerebellum<span class="op">-</span>White<span class="op">-</span>Matter <span class="co">#DCF8A4 Left-Cerebellum-White-Matter 0007  &lt;named list [2]&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9"></a> <span class="dv">6</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Cerebellum<span class="op">-</span>Cortex       <span class="co">#E69422 Left-Cerebellum-Cortex       0008  &lt;named list [2]&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10"></a> <span class="dv">7</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Thalamus<span class="op">-</span>Proper         <span class="co">#00760E Left-Thalamus-Proper         0010  &lt;named list [2]&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11"></a> <span class="dv">8</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Caudate                 <span class="co">#7ABADC Left-Caudate                 0011  &lt;named list [2]&gt;</span></span>
<span id="cb7-12"><a href="#cb7-12"></a> <span class="dv">9</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Putamen                 <span class="co">#EC0DB0 Left-Putamen                 0012  &lt;named list [2]&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="dv">10</span> aseg_3d LCBC  subcort Left<span class="op">-</span>Pallidum                <span class="co">#0C30FF Left-Pallidum                0013  &lt;named list [2]&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co"># … with 33 more rows</span></span></code></pre></div>
<p>Usually, it is the <code>region</code> column we want to do some cleaning of, to make the names of the regions more human readable. This column is populated by the names to each region as specified in the <code>template</code> file.</p>
<p>We can inspect all the unique values in this column, so we can start setting up some logic for renaming the regions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>                        region1                         region2                         region3                         region4 </span>
<span id="cb9-2"><a href="#cb9-2"></a>   <span class="st">"Left-Cerebral-White-Matter"</span>          <span class="st">"Left-Cerebral-Cortex"</span>        <span class="st">"Left-Lateral-Ventricle"</span>             <span class="st">"Left-Inf-Lat-Vent"</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>                        region5                         region6                         region7                         region8 </span>
<span id="cb9-4"><a href="#cb9-4"></a> <span class="st">"Left-Cerebellum-White-Matter"</span>        <span class="st">"Left-Cerebellum-Cortex"</span>          <span class="st">"Left-Thalamus-Proper"</span>                  <span class="st">"Left-Caudate"</span> </span>
<span id="cb9-5"><a href="#cb9-5"></a>                        region9                        region10                        region11                        region12 </span>
<span id="cb9-6"><a href="#cb9-6"></a>                 <span class="st">"Left-Putamen"</span>                 <span class="st">"Left-Pallidum"</span>                 <span class="st">"3rd-Ventricle"</span>                 <span class="st">"4th-Ventricle"</span> </span>
<span id="cb9-7"><a href="#cb9-7"></a>                       region13                        region14                        region15                        region16 </span>
<span id="cb9-8"><a href="#cb9-8"></a>                   <span class="st">"Brain-Stem"</span>              <span class="st">"Left-Hippocampus"</span>                 <span class="st">"Left-Amygdala"</span>                           <span class="st">"CSF"</span> </span>
<span id="cb9-9"><a href="#cb9-9"></a>                       region17                        region18                        region19                        region20 </span>
<span id="cb9-10"><a href="#cb9-10"></a>          <span class="st">"Left-Accumbens-area"</span>                <span class="st">"Left-VentralDC"</span>                   <span class="st">"Left-vessel"</span>           <span class="st">"Left-choroid-plexus"</span> </span>
<span id="cb9-11"><a href="#cb9-11"></a>                       region21                        region22                        region23                        region24 </span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="st">"Right-Cerebral-White-Matter"</span>         <span class="st">"Right-Cerebral-Cortex"</span>       <span class="st">"Right-Lateral-Ventricle"</span>            <span class="st">"Right-Inf-Lat-Vent"</span> </span>
<span id="cb9-13"><a href="#cb9-13"></a>                       region25                        region26                        region27                        region28 </span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="st">"Right-Cerebellum-White-Matter"</span>       <span class="st">"Right-Cerebellum-Cortex"</span>         <span class="st">"Right-Thalamus-Proper"</span>                 <span class="st">"Right-Caudate"</span> </span>
<span id="cb9-15"><a href="#cb9-15"></a>                       region29                        region30                        region31                        region32 </span>
<span id="cb9-16"><a href="#cb9-16"></a>                <span class="st">"Right-Putamen"</span>                <span class="st">"Right-Pallidum"</span>             <span class="st">"Right-Hippocampus"</span>                <span class="st">"Right-Amygdala"</span> </span>
<span id="cb9-17"><a href="#cb9-17"></a>                       region33                        region34                        region35                        region36 </span>
<span id="cb9-18"><a href="#cb9-18"></a>         <span class="st">"Right-Accumbens-area"</span>               <span class="st">"Right-VentralDC"</span>                  <span class="st">"Right-vessel"</span>          <span class="st">"Right-choroid-plexus"</span> </span>
<span id="cb9-19"><a href="#cb9-19"></a>                       region37                        region38                        region39                        region40 </span>
<span id="cb9-20"><a href="#cb9-20"></a>           <span class="st">"WM-hypointensities"</span>                  <span class="st">"Optic-Chiasm"</span>                  <span class="st">"CC_Posterior"</span>              <span class="st">"CC_Mid_Posterior"</span> </span>
<span id="cb9-21"><a href="#cb9-21"></a>                       region41                        region42                        region43 </span>
<span id="cb9-22"><a href="#cb9-22"></a>                   <span class="st">"CC_Central"</span>               <span class="st">"CC_Mid_Anterior"</span>                   <span class="st">"CC_Anterior"</span> </span></code></pre></div>
<p>The region names for this atlas mainly need some white space in-between certain words to make the names readable. For instance, all dashes (<code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>) can be replaced with white space. We’ll try to see other such patterns and how we can easily alter names so they look nicer.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"-|_"</span>, <span class="st">" "</span>, <span class="va">region</span><span class="op">)</span>,
           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,
           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"cc "</span>, <span class="st">"corpus callosum "</span>, <span class="va">region</span><span class="op">)</span> 
           <span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">select</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>                       region1                         region2                         region3                         region4 </span>
<span id="cb11-2"><a href="#cb11-2"></a>   <span class="st">"left cerebral white matter"</span>          <span class="st">"left cerebral cortex"</span>        <span class="st">"left lateral ventricle"</span>             <span class="st">"left inf lat vent"</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>                        region5                         region6                         region7                         region8 </span>
<span id="cb11-4"><a href="#cb11-4"></a> <span class="st">"left cerebellum white matter"</span>        <span class="st">"left cerebellum cortex"</span>          <span class="st">"left thalamus proper"</span>                  <span class="st">"left caudate"</span> </span>
<span id="cb11-5"><a href="#cb11-5"></a>                        region9                        region10                        region11                        region12 </span>
<span id="cb11-6"><a href="#cb11-6"></a>                 <span class="st">"left putamen"</span>                 <span class="st">"left pallidum"</span>                 <span class="st">"3rd ventricle"</span>                 <span class="st">"4th ventricle"</span> </span>
<span id="cb11-7"><a href="#cb11-7"></a>                       region13                        region14                        region15                        region16 </span>
<span id="cb11-8"><a href="#cb11-8"></a>                   <span class="st">"brain stem"</span>              <span class="st">"left hippocampus"</span>                 <span class="st">"left amygdala"</span>                           <span class="st">"csf"</span> </span>
<span id="cb11-9"><a href="#cb11-9"></a>                       region17                        region18                        region19                        region20 </span>
<span id="cb11-10"><a href="#cb11-10"></a>          <span class="st">"left accumbens area"</span>                <span class="st">"left ventraldc"</span>                   <span class="st">"left vessel"</span>           <span class="st">"left choroid plexus"</span> </span>
<span id="cb11-11"><a href="#cb11-11"></a>                       region21                        region22                        region23                        region24 </span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="st">"right cerebral white matter"</span>         <span class="st">"right cerebral cortex"</span>       <span class="st">"right lateral ventricle"</span>            <span class="st">"right inf lat vent"</span> </span>
<span id="cb11-13"><a href="#cb11-13"></a>                       region25                        region26                        region27                        region28 </span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="st">"right cerebellum white matter"</span>       <span class="st">"right cerebellum cortex"</span>         <span class="st">"right thalamus proper"</span>                 <span class="st">"right caudate"</span> </span>
<span id="cb11-15"><a href="#cb11-15"></a>                       region29                        region30                        region31                        region32 </span>
<span id="cb11-16"><a href="#cb11-16"></a>                <span class="st">"right putamen"</span>                <span class="st">"right pallidum"</span>             <span class="st">"right hippocampus"</span>                <span class="st">"right amygdala"</span> </span>
<span id="cb11-17"><a href="#cb11-17"></a>                       region33                        region34                        region35                        region36 </span>
<span id="cb11-18"><a href="#cb11-18"></a>         <span class="st">"right accumbens area"</span>               <span class="st">"right ventraldc"</span>                  <span class="st">"right vessel"</span>          <span class="st">"right choroid plexus"</span> </span>
<span id="cb11-19"><a href="#cb11-19"></a>                       region37                        region38                        region39                        region40 </span>
<span id="cb11-20"><a href="#cb11-20"></a>           <span class="st">"wm hypointensities"</span>                  <span class="st">"optic chiasm"</span>     <span class="st">"corpus callosum posterior"</span> <span class="st">"corpus callosum mid posterior"</span> </span>
<span id="cb11-21"><a href="#cb11-21"></a>                       region41                        region42                        region43 </span>
<span id="cb11-22"><a href="#cb11-22"></a>      <span class="st">"corpus callosum central"</span>  <span class="st">"corpus callosum mid anterior"</span>      <span class="st">"corpus callosum anterior"</span> </span></code></pre></div>
<p>Once we are satisfied with the region names, we should also alter the atlas name in the data, to something a little more pleasing.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"-|_"</span>, <span class="st">" "</span>, <span class="va">region</span><span class="op">)</span>,
           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,
           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"cc "</span>, <span class="st">"corpus callosum "</span>, <span class="va">region</span><span class="op">)</span>, 
           
           atlas <span class="op">=</span> <span class="st">"aseg2_3d"</span>
           <span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># A tibble: 43 x 8</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>   atlas    surf  hemi    region                       colour  label                        roi   mesh            </span>
<span id="cb13-3"><a href="#cb13-3"></a>   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                        </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                        </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>list<span class="op">&gt;</span><span class="st">          </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st"> </span><span class="dv">1</span> aseg2_3d LCBC  subcort left cerebral white matter   <span class="co">#F5F5F5 Left-Cerebral-White-Matter   0002  &lt;named list [2]&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5"></a> <span class="dv">2</span> aseg2_3d LCBC  subcort left cerebral cortex         <span class="co">#CD3E4E Left-Cerebral-Cortex         0003  &lt;named list [2]&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6"></a> <span class="dv">3</span> aseg2_3d LCBC  subcort left lateral ventricle       <span class="co">#781286 Left-Lateral-Ventricle       0004  &lt;named list [2]&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7"></a> <span class="dv">4</span> aseg2_3d LCBC  subcort left inf lat vent            <span class="co">#C43AFA Left-Inf-Lat-Vent            0005  &lt;named list [2]&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8"></a> <span class="dv">5</span> aseg2_3d LCBC  subcort left cerebellum white matter <span class="co">#DCF8A4 Left-Cerebellum-White-Matter 0007  &lt;named list [2]&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9"></a> <span class="dv">6</span> aseg2_3d LCBC  subcort left cerebellum cortex       <span class="co">#E69422 Left-Cerebellum-Cortex       0008  &lt;named list [2]&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10"></a> <span class="dv">7</span> aseg2_3d LCBC  subcort left thalamus proper         <span class="co">#00760E Left-Thalamus-Proper         0010  &lt;named list [2]&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11"></a> <span class="dv">8</span> aseg2_3d LCBC  subcort left caudate                 <span class="co">#7ABADC Left-Caudate                 0011  &lt;named list [2]&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12"></a> <span class="dv">9</span> aseg2_3d LCBC  subcort left putamen                 <span class="co">#EC0DB0 Left-Putamen                 0012  &lt;named list [2]&gt;</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="dv">10</span> aseg2_3d LCBC  subcort left pallidum                <span class="co">#0C30FF Left-Pallidum                0013  &lt;named list [2]&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co"># … with 33 more rows</span></span></code></pre></div>
<p>Of note, at this stage, you can also add <em>other columns</em> of importance to the atlas. As long as these to not conflict in terms of names with the default atlas columns, you can add as many extra columns as you wish. For instance, if this is an atlas based on connectivity, there might be a nested structure to the regions, such that certain regions together form a specific network. Adding a <code>network</code> column specifying which regions belong to which network is then appropriate.</p>
<p>The data include too much though! We cannot see the subcortical structures because the entire cortex is in the way. We should delete the any unnecessary meshes as a whole from the data, so we are only left with subcortical structures.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"-|_"</span>, <span class="st">" "</span>, <span class="va">region</span><span class="op">)</span>,
           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,
           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"cc "</span>, <span class="st">"corpus callosum "</span>, <span class="va">region</span><span class="op">)</span>, 
           
           atlas <span class="op">=</span> <span class="st">"aseg2_3d"</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Cortex|White-Matter"</span>, <span class="va">label</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span></code></pre></div>
<p><img src="figures/aseg.png"><!-- --></p>
</div>
<div id="finalizing-the-atlas" class="section level3">
<h3 class="hasAnchor">
<a href="#finalizing-the-atlas" class="anchor"></a>Finalizing the atlas</h3>
<p>We are now happy with the atlas data we’ve cleaned, so we can go ahead and make it into a ggseg3d-atlas class again by nesting the atlas data by surface and hemisphere</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="va">aseg2_3d</span> <span class="op">%&gt;%</span> 
  <span class="fu">nest_by</span><span class="op">(</span><span class="va">atlas</span>, <span class="va">surf</span>, <span class="va">hemi</span>, .key <span class="op">=</span> <span class="st">"ggseg_3d"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d_atlas-class.html">as_ggseg3d_atlas</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">aseg2_3d</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># A tibble: 1 x 4</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  atlas    surf  hemi    ggseg_3d         </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>list<span class="op">&gt;</span><span class="st">           </span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="dv">1</span> aseg2_3d LCBC  subcort <span class="op">&lt;</span>tibble [<span class="dv">35</span> × <span class="dv">5</span>]<span class="op">&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/add_glassbrain.html">add_glassbrain</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="figures/aseg_glass.png"><!-- --></p>
</div>
</div>
<div id="creating-the-2d-atlas" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-the-2d-atlas" class="anchor"></a>Creating the 2d atlas</h2>
<p>Unlike the pipeline for cortical atlases which uses the newly made ggseg3d-atlas to create polygon data, the volumetric pipeline uses the volumetric-image just as for creating the ggseg3d-atlas above. Using a combination of FreeSurfer’s Freeview snapshotting andImageMagick, the <code><a href="../reference/make_ggseg3d_2_ggseg.html">make_ggseg3d_2_ggseg()</a></code> function takes snapshots of each region, for each hemisphere and lateral/medial view, extracts the contours of these regions, smooth’es them, reduces the vertices and organizes the data into a brain-atlas class object. The function creates a lot of intermediary files (mostly snapshots), and will likely require you to re-run several steps to produce the wanted end result. While the function at default stores these files in a temporary folder, we highly recommend setting the <code>output_dir</code> option, so that you do not need to rerun all steps when testing another configuration of settings. For instance, the step taking the longest time and most processing time is snapshotting the regions and extracting the contours. But these two steps only need to be run once, as long as the ggseg3d-atlas has not changed somehow.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make atlas ----</span>
<span class="va">aseg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_volumetric_ggseg.html">make_volumetric_ggseg</a></span><span class="op">(</span>
  label_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_subj_dir.html">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5"</span>, <span class="st">"mri/aseg.mgz"</span><span class="op">)</span>,
  vertex_size_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span>,
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>● <span class="dv">1</span><span class="op">/</span><span class="dv">7</span> Snapshotting views of entire atlas to <span class="op">~</span><span class="er">/</span>Desktop<span class="op">/</span><span class="er">/</span>dkt</span>
<span id="cb20-2"><a href="#cb20-2"></a>✓ Snapshots complete</span>
<span id="cb20-3"><a href="#cb20-3"></a>● <span class="dv">2</span><span class="op">/</span><span class="dv">7</span> Snapshotting individual regions to <span class="op">~</span><span class="er">/</span>Desktop<span class="op">/</span><span class="er">/</span>dkt<span class="op">/</span>img</span>
<span id="cb20-4"><a href="#cb20-4"></a>✓ Region snapshots complete</span>
<span id="cb20-5"><a href="#cb20-5"></a>● <span class="dv">3</span><span class="op">/</span><span class="dv">7</span> Isolating regions to <span class="op">~</span><span class="er">/</span>Desktop<span class="op">/</span><span class="er">/</span>dkt<span class="op">/</span>masks</span>
<span id="cb20-6"><a href="#cb20-6"></a>● <span class="op">&amp;</span><span class="st"> </span>writing masks to <span class="op">~</span><span class="er">/</span>Desktop<span class="op">/</span><span class="er">/</span>dkt<span class="op">/</span>regions</span>
<span id="cb20-7"><a href="#cb20-7"></a>✓ isolation complete</span>
<span id="cb20-8"><a href="#cb20-8"></a>● <span class="dv">4</span><span class="op">/</span><span class="dv">7</span> Extracting contours from regions</span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="op">|</span><span class="er">===================================================================|</span><span class="st"> </span><span class="dv">100</span>%, Elapsed <span class="dv">00</span><span class="op">:</span><span class="dv">25</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>✓ contours complete</span>
<span id="cb20-11"><a href="#cb20-11"></a>● <span class="dv">5</span><span class="op">/</span><span class="dv">7</span> Smoothing contours</span>
<span id="cb20-12"><a href="#cb20-12"></a>✓ Smoothing complete</span>
<span id="cb20-13"><a href="#cb20-13"></a>● <span class="dv">6</span><span class="op">/</span><span class="dv">7</span> Reducing vertexes</span>
<span id="cb20-14"><a href="#cb20-14"></a>✓ Vertexes reduced</span>
<span id="cb20-15"><a href="#cb20-15"></a>● <span class="dv">7</span><span class="op">/</span><span class="dv">7</span> Making data frame</span>
<span id="cb20-16"><a href="#cb20-16"></a>✓ Atlas complete with <span class="dv">3694</span> vertices</span></code></pre></div>
<p>The most likely steps to redo are steps 5-7, tweaking the <code>smoothness</code> and <code>tolerance</code> arguments to improve how the polygons look and how many vertices there are. The fewer vertices, the faster the plot renders, but too few and the polygons will look poor.</p>
<div id="inspecting-the-atlas-object" class="section level3">
<h3 class="hasAnchor">
<a href="#inspecting-the-atlas-object" class="anchor"></a>Inspecting the atlas object</h3>
<p>First step is to have a look at the actual object. If the brain-atlas is correctly set up, the output should look like the below.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dkt</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># dkt cortical brain atlas</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  regions<span class="op">:</span><span class="st"> </span><span class="dv">31</span> </span>
<span id="cb22-3"><a href="#cb22-3"></a>  hemispheres<span class="op">:</span><span class="st"> </span>left, right </span>
<span id="cb22-4"><a href="#cb22-4"></a>  side views<span class="op">:</span><span class="st"> </span>lateral, medial </span>
<span id="cb22-5"><a href="#cb22-5"></a>  palette<span class="op">:</span><span class="st"> </span>yes </span>
<span id="cb22-6"><a href="#cb22-6"></a>  use<span class="op">:</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_brain</span>() </span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="op">----</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="st">   </span>hemi  side    region                label                   roi  </span>
<span id="cb22-9"><a href="#cb22-9"></a>   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                 </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="st"> </span><span class="dv">1</span> left  lateral caudal middle frontal lh_caudalmiddlefrontal  <span class="dv">0002</span> </span>
<span id="cb22-11"><a href="#cb22-11"></a> <span class="dv">2</span> left  lateral fusiform              lh_fusiform             <span class="dv">0005</span> </span>
<span id="cb22-12"><a href="#cb22-12"></a> <span class="dv">3</span> left  lateral inferior parietal     lh_inferiorparietal     <span class="dv">0006</span> </span>
<span id="cb22-13"><a href="#cb22-13"></a> <span class="dv">4</span> left  lateral inferior temporal     lh_inferiortemporal     <span class="dv">0007</span> </span>
<span id="cb22-14"><a href="#cb22-14"></a> <span class="dv">5</span> left  lateral lateral occipital     lh_lateraloccipital     <span class="dv">0009</span> </span>
<span id="cb22-15"><a href="#cb22-15"></a> <span class="dv">6</span> left  lateral lateral orbitofrontal lh_lateralorbitofrontal <span class="dv">0010</span> </span>
<span id="cb22-16"><a href="#cb22-16"></a> <span class="dv">7</span> left  lateral middle temporal       lh_middletemporal       <span class="dv">0013</span> </span>
<span id="cb22-17"><a href="#cb22-17"></a> <span class="dv">8</span> left  lateral pars opercularis      lh_parsopercularis      <span class="dv">0016</span> </span>
<span id="cb22-18"><a href="#cb22-18"></a> <span class="dv">9</span> left  lateral pars orbitalis        lh_parsorbitalis        <span class="dv">0017</span> </span>
<span id="cb22-19"><a href="#cb22-19"></a><span class="dv">10</span> left  lateral pars triangularis     lh_parstriangularis     <span class="dv">0018</span> </span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="co"># … with 71 more rows</span></span></code></pre></div>
<p>Second step is to make sure the data is being plotted correctly.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dkt</span><span class="op">)</span></code></pre></div>
<p><img src="figures/dkt.png"><!-- --></p>
<p>In most cases, given the values in the 3d-atlas’ <code>colour</code> column is correctly applied, but problems may arise given how annotation files are set up.</p>
</div>
<div id="fixing-the-palette" class="section level3">
<h3 class="hasAnchor">
<a href="#fixing-the-palette" class="anchor"></a>Fixing the palette</h3>
<p>Many annotation files have a unique colour for the same regions but in different hemispheres. This can often mess up the palette for the 2d-atlas, which needs the regions in the different hemispheres to have the same palette colour.</p>
<p>If you are working with an atlas that does not have a colour-scheme dispatched with the atlas, the palette should be set to <code>NULL</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dkt</span><span class="op">$</span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">dkt</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># dkt cortical brain atlas</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  regions<span class="op">:</span><span class="st"> </span><span class="dv">31</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>  hemispheres<span class="op">:</span><span class="st"> </span>left, right </span>
<span id="cb25-4"><a href="#cb25-4"></a>  side views<span class="op">:</span><span class="st"> </span>lateral, medial </span>
<span id="cb25-5"><a href="#cb25-5"></a>  palette<span class="op">:</span><span class="st"> </span>no </span>
<span id="cb25-6"><a href="#cb25-6"></a>  use<span class="op">:</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_brain</span>() </span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="op">----</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="st">   </span>hemi  side    region                label                   roi  </span>
<span id="cb25-9"><a href="#cb25-9"></a>   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                 </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">                   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="st"> </span><span class="dv">1</span> left  lateral caudal middle frontal lh_caudalmiddlefrontal  <span class="dv">0002</span> </span>
<span id="cb25-11"><a href="#cb25-11"></a> <span class="dv">2</span> left  lateral fusiform              lh_fusiform             <span class="dv">0005</span> </span>
<span id="cb25-12"><a href="#cb25-12"></a> <span class="dv">3</span> left  lateral inferior parietal     lh_inferiorparietal     <span class="dv">0006</span> </span>
<span id="cb25-13"><a href="#cb25-13"></a> <span class="dv">4</span> left  lateral inferior temporal     lh_inferiortemporal     <span class="dv">0007</span> </span>
<span id="cb25-14"><a href="#cb25-14"></a> <span class="dv">5</span> left  lateral lateral occipital     lh_lateraloccipital     <span class="dv">0009</span> </span>
<span id="cb25-15"><a href="#cb25-15"></a> <span class="dv">6</span> left  lateral lateral orbitofrontal lh_lateralorbitofrontal <span class="dv">0010</span> </span>
<span id="cb25-16"><a href="#cb25-16"></a> <span class="dv">7</span> left  lateral middle temporal       lh_middletemporal       <span class="dv">0013</span> </span>
<span id="cb25-17"><a href="#cb25-17"></a> <span class="dv">8</span> left  lateral pars opercularis      lh_parsopercularis      <span class="dv">0016</span> </span>
<span id="cb25-18"><a href="#cb25-18"></a> <span class="dv">9</span> left  lateral pars orbitalis        lh_parsorbitalis        <span class="dv">0017</span> </span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="dv">10</span> left  lateral pars triangularis     lh_parstriangularis     <span class="dv">0018</span> </span>
<span id="cb25-20"><a href="#cb25-20"></a><span class="co"># … with 71 more rows</span></span></code></pre></div>
<p>When there is no palette, the default atlas plot will return with default ggplot2 colours. This is absolutely a valid option. The palette is an optional part of the atlas.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dkt</span><span class="op">)</span></code></pre></div>
<p><img src="figures/dkt_nocol.png" width="90%"></p>
<p>If you want to correctly apply a palette, the <code>dkt$palette</code> part of the atlas is a named character vector, where the value of the vector is the hex-colour code, and the names of the elements are the region names as seen in the <code>region</code> column of the atlas data.</p>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>All together, the script to create both 3d and 2d atlases of the aseg parcellation looks like this:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LCBC-UiO/ggsegExtra">ggsegExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LCBC-UiO/ggseg">ggseg</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>

<span class="co"># Make  3d ----</span>
<span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="fu">make_aseg_2_3datlas</span><span class="op">(</span>
  subject <span class="op">=</span> <span class="st">"fsaverage5"</span>,
  subjects_dir <span class="op">=</span> <span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_subj_dir.html">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>,
  template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_subj_dir.html">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5"</span>, <span class="st">"mri/aseg.mgz"</span><span class="op">)</span>,
  output_dir <span class="op">=</span> <span class="st">"~/Desktop/aseg"</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span>

<span class="co"># make atlas ----</span>
<span class="va">aseg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_volumetric_ggseg.html">make_volumetric_ggseg</a></span><span class="op">(</span>subject <span class="op">=</span> <span class="st">"fsaverage5"</span>,
                               steps <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,
                               output_dir <span class="op">=</span> <span class="st">"~/Desktop/aseg"</span>,
                               vertex_size_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span>,
                               label_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_subj_dir.html">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5"</span>, <span class="st">"mri/aseg.mgz"</span><span class="op">)</span><span class="op">)</span>

<span class="va">aseg2</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">aseg2</span><span class="op">$</span><span class="va">data</span>, 
                     <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Unknown"</span>, <span class="va">label</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                     <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"White-matter"</span>, <span class="va">label</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"cortex"</span>, <span class="va">region</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="va">region</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">aseg2</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Athanasia Mo Mowinckel, Didac Vidal-Piñeiro.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
