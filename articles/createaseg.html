<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example creation: the aseg subcortical atlas • ggsegExtra</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example creation: the aseg subcortical atlas">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggsegExtra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ggsegExtra.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/system_setup.html">System Setup</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ggseg/ggsegExtra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example creation: the aseg subcortical atlas</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ggseg/ggsegExtra/blob/main/vignettes/createaseg.Rmd" class="external-link"><code>vignettes/createaseg.Rmd</code></a></small>
      <div class="d-none name"><code>createaseg.Rmd</code></div>
    </div>

    
    
<p>Here we provide an example of creating a cortical ggseg and ggseg3d
atlas. To read more about the details of the process, see the vignette
on <a href="customatlas3d.html">creating custom3d atlases</a> and <a href="customatlas.html">creating custom polygon atlases</a>.</p>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>To successfully run these operations, you must have the following
installed on your system, and be running it on either a Linux or Mac. -
<a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/" class="external-link">FSL</a> - <a href="https://surfer.nmr.mgh.harvard.edu/" class="external-link">FreeSurfer</a> - <a href="https://www.r-project.org/" class="external-link">R</a> - <a href="https://imagemagick.org/index.php" class="external-link">ImageMagick</a> - <a href="https://github.com/plotly/orca" class="external-link">orca</a></p>
<p>Initiate your R script with the following library calls:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ggseg/ggsegExtra" class="external-link">ggsegExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ggseg/ggseg" class="external-link">ggseg</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ggseg/ggseg3d/" class="external-link">ggseg3d</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> <span class="co"># for cleaning the atlas data efficiently</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-3d-atlas">Creating a 3d atlas<a class="anchor" aria-label="anchor" href="#creating-a-3d-atlas"></a>
</h2>
<div class="section level3">
<h3 id="the-template-file">The template file<a class="anchor" aria-label="anchor" href="#the-template-file"></a>
</h3>
<p>Sub-cortical segmentations are usually stored in volumetric images
with <code>.mgz</code> extension. These usually also include the cortex,
white matter and CSF. Some volumetric segmentations may contain both
segmentations of the cortex and the sub-cortex. If you have such a
template, we would recommend making a version where the cortex is one
large segmentation, and rather create a separate cortical atlas.</p>
</div>
<div class="section level3">
<h3 id="the-3d-atlas">The 3d atlas<a class="anchor" aria-label="anchor" href="#the-3d-atlas"></a>
</h3>
<p>We assume the volumetric image you have is for a FreeSurfer subject,
specifically registered to the “fsaverage5” subject, which is a good
balance between number of vertices and details. If you need to register
the volume to “fsaverage5”, there are FreeSurfer tools to help with
this, but we have not set up any function for this in R. If you have
suggestions or know of an easy command to do this, let us know in the <a href="https://github.com/ggseg/ggsegExtra/issues" class="external-link">issues</a> so we can
try implementing your solution here.</p>
<p>To turn a volumetric image to a ggseg3d-atlas, use the function
<code>make_volumetric_2_3datlas</code>. This will call a series of
FreeSurfer functions to create ascii and ply files for the mesh plots.
The function creates several intermediary files which are saved in the
output_dir specified.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make  3d ----</span></span>
<span><span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_volumetric_2_3datlas.html">make_volumetric_2_3datlas</a></span><span class="op">(</span></span>
<span>  subject <span class="op">=</span> <span class="st">"fsaverage5"</span>,</span>
<span>  subjects_dir <span class="op">=</span> <span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_dir.html" class="external-link">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_dir.html" class="external-link">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5/mri/aseg.mgz"</span><span class="op">)</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"~/Desktop/aseg"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html" class="external-link">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg_raw.png"><!-- --></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aseg2_3d</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># A tibble: 1 x 4</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  atlas   surf  hemi              ggseg_3d</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>list<span class="sc">&lt;</span>tbl_df[,<span class="dv">5</span>]<span class="sc">&gt;</span><span class="er">&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="dv">1</span> aseg_3d LCBC  subcort           [<span class="dv">43</span> × <span class="dv">5</span>]</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cleaning-the-atlas-data">Cleaning the atlas data<a class="anchor" aria-label="anchor" href="#cleaning-the-atlas-data"></a>
</h3>
<p>The atlas data usually needs some manual editing to get it into a
nice shape for other users, and for nice plotting. We are avid <a href="https://tidyverse.org/" class="external-link">tidyverse</a> users, and as such the
procedures we use here to clean the data use tidyverse functions.</p>
<p>First, we will unnest the <code>ggseg_3d</code> column, so we can see
what the atlas data contains.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># A tibble: 43 x 8</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>   atlas   surf  hemi    region                       colour  label                        roi   mesh</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                        <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a> <span class="dv">1</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Cerebral<span class="sc">-</span>White<span class="sc">-</span>Matter   <span class="co">#F5F5F5 Left-Cerebral-White-Matter   0002  &lt;named list [2]&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a> <span class="dv">2</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Cerebral<span class="sc">-</span>Cortex         <span class="co">#CD3E4E Left-Cerebral-Cortex         0003  &lt;named list [2]&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a> <span class="dv">3</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Lateral<span class="sc">-</span>Ventricle       <span class="co">#781286 Left-Lateral-Ventricle       0004  &lt;named list [2]&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a> <span class="dv">4</span> aseg_3d LCBC  subcort Left<span class="sc">-</span><span class="cn">Inf</span><span class="sc">-</span>Lat<span class="sc">-</span>Vent            <span class="co">#C43AFA Left-Inf-Lat-Vent            0005  &lt;named list [2]&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a> <span class="dv">5</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Cerebellum<span class="sc">-</span>White<span class="sc">-</span>Matter <span class="co">#DCF8A4 Left-Cerebellum-White-Matter 0007  &lt;named list [2]&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a> <span class="dv">6</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Cerebellum<span class="sc">-</span>Cortex       <span class="co">#E69422 Left-Cerebellum-Cortex       0008  &lt;named list [2]&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a> <span class="dv">7</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Thalamus<span class="sc">-</span>Proper         <span class="co">#00760E Left-Thalamus-Proper         0010  &lt;named list [2]&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a> <span class="dv">8</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Caudate                 <span class="co">#7ABADC Left-Caudate                 0011  &lt;named list [2]&gt;</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a> <span class="dv">9</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Putamen                 <span class="co">#EC0DB0 Left-Putamen                 0012  &lt;named list [2]&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="dv">10</span> aseg_3d LCBC  subcort Left<span class="sc">-</span>Pallidum                <span class="co">#0C30FF Left-Pallidum                0013  &lt;named list [2]&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co"># … with 33 more rows</span></span></code></pre></div>
<p>Usually, it is the <code>region</code> column we want to do some
cleaning of, to make the names of the regions more human readable. This
column is populated by the names to each region as specified in the
<code>template</code> file.</p>
<p>We can inspect all the unique values in this column, so we can start
setting up some logic for renaming the regions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>                        region1                         region2                         region3                         region4</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>   <span class="st">"Left-Cerebral-White-Matter"</span>          <span class="st">"Left-Cerebral-Cortex"</span>        <span class="st">"Left-Lateral-Ventricle"</span>             <span class="st">"Left-Inf-Lat-Vent"</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                        region5                         region6                         region7                         region8</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a> <span class="st">"Left-Cerebellum-White-Matter"</span>        <span class="st">"Left-Cerebellum-Cortex"</span>          <span class="st">"Left-Thalamus-Proper"</span>                  <span class="st">"Left-Caudate"</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>                        region9                        region10                        region11                        region12</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                 <span class="st">"Left-Putamen"</span>                 <span class="st">"Left-Pallidum"</span>                 <span class="st">"3rd-Ventricle"</span>                 <span class="st">"4th-Ventricle"</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                       region13                        region14                        region15                        region16</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>                   <span class="st">"Brain-Stem"</span>              <span class="st">"Left-Hippocampus"</span>                 <span class="st">"Left-Amygdala"</span>                           <span class="st">"CSF"</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>                       region17                        region18                        region19                        region20</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>          <span class="st">"Left-Accumbens-area"</span>                <span class="st">"Left-VentralDC"</span>                   <span class="st">"Left-vessel"</span>           <span class="st">"Left-choroid-plexus"</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>                       region21                        region22                        region23                        region24</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="st">"Right-Cerebral-White-Matter"</span>         <span class="st">"Right-Cerebral-Cortex"</span>       <span class="st">"Right-Lateral-Ventricle"</span>            <span class="st">"Right-Inf-Lat-Vent"</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>                       region25                        region26                        region27                        region28</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="st">"Right-Cerebellum-White-Matter"</span>       <span class="st">"Right-Cerebellum-Cortex"</span>         <span class="st">"Right-Thalamus-Proper"</span>                 <span class="st">"Right-Caudate"</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>                       region29                        region30                        region31                        region32</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>                <span class="st">"Right-Putamen"</span>                <span class="st">"Right-Pallidum"</span>             <span class="st">"Right-Hippocampus"</span>                <span class="st">"Right-Amygdala"</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>                       region33                        region34                        region35                        region36</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>         <span class="st">"Right-Accumbens-area"</span>               <span class="st">"Right-VentralDC"</span>                  <span class="st">"Right-vessel"</span>          <span class="st">"Right-choroid-plexus"</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>                       region37                        region38                        region39                        region40</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>           <span class="st">"WM-hypointensities"</span>                  <span class="st">"Optic-Chiasm"</span>                  <span class="st">"CC_Posterior"</span>              <span class="st">"CC_Mid_Posterior"</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>                       region41                        region42                        region43</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>                   <span class="st">"CC_Central"</span>               <span class="st">"CC_Mid_Anterior"</span>                   <span class="st">"CC_Anterior"</span></span></code></pre></div>
<p>The region names for this atlas mainly need some white space
in-between certain words to make the names readable. For instance, all
dashes (<code>-</code>) can be replaced with white space. We’ll try to
see other such patterns and how we can easily alter names so they look
nicer.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-|_"</span>, <span class="st">" "</span>, <span class="va">region</span><span class="op">)</span>,</span>
<span>           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,</span>
<span>           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"cc "</span>, <span class="st">"corpus callosum "</span>, <span class="va">region</span><span class="op">)</span></span>
<span>           <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>                       region1                         region2                         region3                         region4</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>   <span class="st">"left cerebral white matter"</span>          <span class="st">"left cerebral cortex"</span>        <span class="st">"left lateral ventricle"</span>             <span class="st">"left inf lat vent"</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>                        region5                         region6                         region7                         region8</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a> <span class="st">"left cerebellum white matter"</span>        <span class="st">"left cerebellum cortex"</span>          <span class="st">"left thalamus proper"</span>                  <span class="st">"left caudate"</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>                        region9                        region10                        region11                        region12</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>                 <span class="st">"left putamen"</span>                 <span class="st">"left pallidum"</span>                 <span class="st">"3rd ventricle"</span>                 <span class="st">"4th ventricle"</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>                       region13                        region14                        region15                        region16</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>                   <span class="st">"brain stem"</span>              <span class="st">"left hippocampus"</span>                 <span class="st">"left amygdala"</span>                           <span class="st">"csf"</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>                       region17                        region18                        region19                        region20</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>          <span class="st">"left accumbens area"</span>                <span class="st">"left ventraldc"</span>                   <span class="st">"left vessel"</span>           <span class="st">"left choroid plexus"</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>                       region21                        region22                        region23                        region24</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  <span class="st">"right cerebral white matter"</span>         <span class="st">"right cerebral cortex"</span>       <span class="st">"right lateral ventricle"</span>            <span class="st">"right inf lat vent"</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>                       region25                        region26                        region27                        region28</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="st">"right cerebellum white matter"</span>       <span class="st">"right cerebellum cortex"</span>         <span class="st">"right thalamus proper"</span>                 <span class="st">"right caudate"</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>                       region29                        region30                        region31                        region32</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>                <span class="st">"right putamen"</span>                <span class="st">"right pallidum"</span>             <span class="st">"right hippocampus"</span>                <span class="st">"right amygdala"</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>                       region33                        region34                        region35                        region36</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>         <span class="st">"right accumbens area"</span>               <span class="st">"right ventraldc"</span>                  <span class="st">"right vessel"</span>          <span class="st">"right choroid plexus"</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>                       region37                        region38                        region39                        region40</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>           <span class="st">"wm hypointensities"</span>                  <span class="st">"optic chiasm"</span>     <span class="st">"corpus callosum posterior"</span> <span class="st">"corpus callosum mid posterior"</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>                       region41                        region42                        region43</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>      <span class="st">"corpus callosum central"</span>  <span class="st">"corpus callosum mid anterior"</span>      <span class="st">"corpus callosum anterior"</span></span></code></pre></div>
<p>Once we are satisfied with the region names, we should also alter the
atlas name in the data, to something a little more pleasing.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-|_"</span>, <span class="st">" "</span>, <span class="va">region</span><span class="op">)</span>,</span>
<span>           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,</span>
<span>           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"cc "</span>, <span class="st">"corpus callosum "</span>, <span class="va">region</span><span class="op">)</span>,</span>
<span></span>
<span>           atlas <span class="op">=</span> <span class="st">"aseg2_3d"</span></span>
<span>           <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># A tibble: 43 x 8</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>   atlas    surf  hemi    region                       colour  label                        roi   mesh</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                        <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a> <span class="dv">1</span> aseg2_3d LCBC  subcort left cerebral white matter   <span class="co">#F5F5F5 Left-Cerebral-White-Matter   0002  &lt;named list [2]&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a> <span class="dv">2</span> aseg2_3d LCBC  subcort left cerebral cortex         <span class="co">#CD3E4E Left-Cerebral-Cortex         0003  &lt;named list [2]&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a> <span class="dv">3</span> aseg2_3d LCBC  subcort left lateral ventricle       <span class="co">#781286 Left-Lateral-Ventricle       0004  &lt;named list [2]&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a> <span class="dv">4</span> aseg2_3d LCBC  subcort left inf lat vent            <span class="co">#C43AFA Left-Inf-Lat-Vent            0005  &lt;named list [2]&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a> <span class="dv">5</span> aseg2_3d LCBC  subcort left cerebellum white matter <span class="co">#DCF8A4 Left-Cerebellum-White-Matter 0007  &lt;named list [2]&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a> <span class="dv">6</span> aseg2_3d LCBC  subcort left cerebellum cortex       <span class="co">#E69422 Left-Cerebellum-Cortex       0008  &lt;named list [2]&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a> <span class="dv">7</span> aseg2_3d LCBC  subcort left thalamus proper         <span class="co">#00760E Left-Thalamus-Proper         0010  &lt;named list [2]&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a> <span class="dv">8</span> aseg2_3d LCBC  subcort left caudate                 <span class="co">#7ABADC Left-Caudate                 0011  &lt;named list [2]&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a> <span class="dv">9</span> aseg2_3d LCBC  subcort left putamen                 <span class="co">#EC0DB0 Left-Putamen                 0012  &lt;named list [2]&gt;</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="dv">10</span> aseg2_3d LCBC  subcort left pallidum                <span class="co">#0C30FF Left-Pallidum                0013  &lt;named list [2]&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co"># … with 33 more rows</span></span></code></pre></div>
<p>Of note, at this stage, you can also add <em>other columns</em> of
importance to the atlas. As long as these to not conflict in terms of
names with the default atlas columns, you can add as many extra columns
as you wish. For instance, if this is an atlas based on connectivity,
there might be a nested structure to the regions, such that certain
regions together form a specific network. Adding a <code>network</code>
column specifying which regions belong to which network is then
appropriate.</p>
<p>The data include too much though! We cannot see the sub-cortical
structures because the entire cortex is in the way. We should delete the
any unnecessary meshes as a whole from the data, so we are only left
with sub-cortical structures.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="fu">unnest</span><span class="op">(</span><span class="va">aseg2_3d</span>, <span class="va">ggseg_3d</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-|_"</span>, <span class="st">" "</span>, <span class="va">region</span><span class="op">)</span>,</span>
<span>           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,</span>
<span>           region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"cc "</span>, <span class="st">"corpus callosum "</span>, <span class="va">region</span><span class="op">)</span>,</span>
<span></span>
<span>           atlas <span class="op">=</span> <span class="st">"aseg2_3d"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Cortex|White-Matter"</span>, <span class="va">label</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html" class="external-link">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg.png"><!-- --></p>
</div>
<div class="section level3">
<h3 id="finalizing-the-atlas">Finalizing the atlas<a class="anchor" aria-label="anchor" href="#finalizing-the-atlas"></a>
</h3>
<p>We are now happy with the atlas data we’ve cleaned, so we can go
ahead and make it into a ggseg3d-atlas class again by nesting the atlas
data by surface and hemisphere</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="va">aseg2_3d</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">nest_by</span><span class="op">(</span><span class="va">atlas</span>, <span class="va">surf</span>, <span class="va">hemi</span>, .key <span class="op">=</span> <span class="st">"ggseg_3d"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d_atlas-class.html" class="external-link">as_ggseg3d_atlas</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aseg2_3d</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># A tibble: 1 x 4</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  atlas    surf  hemi    ggseg_3d</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>list<span class="sc">&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="dv">1</span> aseg2_3d LCBC  subcort <span class="sc">&lt;</span>tibble [<span class="dv">35</span> × <span class="dv">5</span>]<span class="sc">&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html" class="external-link">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/add_glassbrain.html" class="external-link">add_glassbrain</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg_glass.png"><!-- --></p>
</div>
</div>
<div class="section level2">
<h2 id="creating-the-2d-atlas">Creating the 2d atlas<a class="anchor" aria-label="anchor" href="#creating-the-2d-atlas"></a>
</h2>
<p>Unlike the pipeline for cortical atlases which uses the newly made
ggseg3d-atlas to create polygon data, the volumetric pipeline uses the
volumetric-image just as for creating the ggseg3d-atlas above. Using a
combination of FreeSurfer’s Freeview snapshotting and ImageMagick, the
<code><a href="../reference/make_ggseg3d_2_ggseg.html">make_ggseg3d_2_ggseg()</a></code> function takes snapshots of each
region and slice combination, extracts the contours of these regions,
smooths them, reduces the vertices and organizes the data into a
brain-atlas class object. The function creates a lot of intermediary
files (mostly snapshots), and will likely require you to re-run several
steps to produce the wanted end result. While the function at default
stores these files in a temporary folder, we highly recommend setting
the <code>output_dir</code> option, so that you do not need to rerun all
steps when testing another configuration of settings. For instance, the
step taking the longest time and most processing time is snapshotting
the regions and extracting the contours. But these two steps only need
to be run once, as long as the ggseg3d-atlas has not changed
somehow.</p>
<p>The creation function need a data.frame with information on which
slices to snapshot using Freeview.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">130</span>, <span class="fl">122</span>, <span class="fl">122</span><span class="op">)</span>,</span>
<span>           y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">130</span>, <span class="fl">235</span>, <span class="fl">112</span><span class="op">)</span>,</span>
<span>           z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">130</span>, <span class="fl">100</span>, <span class="fl">106</span><span class="op">)</span>,</span>
<span>           view <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"axial"</span>, <span class="st">"sagittal"</span>, <span class="st">"coronal"</span><span class="op">)</span>,</span>
<span>           stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">slices</span></span></code></pre></div>
<p>This data.frame is provided to the <code>slices</code> arguments, and
will ultimately become the slices in your plot.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make atlas ----</span></span>
<span><span class="va">aseg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_volumetric_ggseg.html">make_volumetric_ggseg</a></span><span class="op">(</span></span>
<span>  label_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_dir.html" class="external-link">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5"</span>, <span class="st">"mri/aseg.mgz"</span><span class="op">)</span>,</span>
<span>  slices <span class="op">=</span> <span class="va">slices</span>,</span>
<span>  vertex_size_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>● <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span> Preparing labels</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="sc">|</span><span class="er">==============================================|</span> <span class="dv">100</span>%, Elapsed <span class="dv">00</span><span class="sc">:</span><span class="dv">24</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>✓ labels ready</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>● <span class="dv">2</span><span class="sc">/</span><span class="dv">8</span> Snapshotting views of regions to <span class="sc">~</span><span class="er">/</span>Desktop<span class="sc">/</span>aseg<span class="sc">/</span>snapshots,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="sc">|</span><span class="er">======================================================|</span> <span class="dv">100</span>%, Elapsed <span class="dv">03</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>✓ snapshots complete</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>● <span class="dv">3</span><span class="sc">/</span><span class="dv">8</span> isolating regions to <span class="sc">~</span><span class="er">/</span>Desktop<span class="sc">/</span>aseg<span class="sc">/</span>interrim</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  <span class="sc">|</span><span class="er">======================================================|</span> <span class="dv">100</span>%, Elapsed <span class="dv">00</span><span class="sc">:</span><span class="dv">01</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>✓ isolation complete</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>● <span class="dv">4</span><span class="sc">/</span><span class="dv">8</span> Writing masks to <span class="sc">~</span><span class="er">/</span>Desktop<span class="sc">/</span>aseg<span class="sc">/</span>masks</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>  <span class="sc">|</span><span class="er">======================================================|</span> <span class="dv">100</span>%, Elapsed <span class="dv">00</span><span class="sc">:</span><span class="dv">02</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>✓ masks complete</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>● <span class="dv">5</span><span class="sc">/</span><span class="dv">8</span> Extracting contours from regions</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>  <span class="sc">|</span><span class="er">======================================================|</span> <span class="dv">100</span>%, Elapsed <span class="dv">00</span><span class="sc">:</span><span class="dv">31</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>✓ contours complete</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>● <span class="dv">6</span><span class="sc">/</span><span class="dv">8</span> Smoothing contours</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>✓ Smoothing complete</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>● <span class="dv">7</span><span class="sc">/</span><span class="dv">8</span> Reducing vertexes</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>✓ Vertexes reduced</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>● <span class="dv">8</span><span class="sc">/</span><span class="dv">8</span> Cleaning up data</span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>● Atlas is complete with <span class="dv">244718</span> vertices, try re<span class="sc">-</span>running steps <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span> with a higher <span class="st">'tolerance'</span> number.</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>✓ cleanup complete</span></code></pre></div>
<p>The most likely steps to redo are steps 6-8, tweaking the
<code>smoothness</code> and <code>tolerance</code> arguments to improve
how the polygons look and how many vertices there are. The fewer
vertices, the faster the plot renders, but too few and the polygons will
look poor.</p>
<div class="section level3">
<h3 id="inspecting-the-atlas-object">Inspecting the atlas object<a class="anchor" aria-label="anchor" href="#inspecting-the-atlas-object"></a>
</h3>
<p>First step is to have a look at the actual object. If the brain-atlas
is correctly set up, the output should look like the below.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aseg2</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># aseg subcortical brain atlas</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  regions<span class="sc">:</span> <span class="dv">19</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  hemispheres<span class="sc">:</span> <span class="cn">NA</span>, left, right</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  side views<span class="sc">:</span> coronal, sagittal, axial</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  palette<span class="sc">:</span> yes</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  use<span class="sc">:</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_brain</span>()</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="sc">----</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>   side    hemi  roi   label                      region</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                      <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a> <span class="dv">1</span> coronal left  <span class="dv">0002</span>  Left<span class="sc">-</span>Cerebral<span class="sc">-</span>White<span class="sc">-</span>Matter cerebral white matter</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a> <span class="dv">2</span> coronal left  <span class="dv">0003</span>  Left<span class="sc">-</span>Cerebral<span class="sc">-</span>Cortex       cerebral cortex</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a> <span class="dv">3</span> coronal left  <span class="dv">0004</span>  Left<span class="sc">-</span>Lateral<span class="sc">-</span>Ventricle     lateral ventricle</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a> <span class="dv">4</span> coronal left  <span class="dv">0010</span>  Left<span class="sc">-</span>Thalamus<span class="sc">-</span>Proper       thalamus proper</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a> <span class="dv">5</span> coronal left  <span class="dv">0012</span>  Left<span class="sc">-</span>Putamen               putamen</span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a> <span class="dv">6</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0014</span>  <span class="dv">3</span>rd<span class="sc">-</span>Ventricle              <span class="dv">3</span>rd ventricle</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a> <span class="dv">7</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0016</span>  Brain<span class="sc">-</span>Stem                 brain stem</span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a> <span class="dv">8</span> coronal left  <span class="dv">0017</span>  Left<span class="sc">-</span>Hippocampus           hippocampus</span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a> <span class="dv">9</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0024</span>  CSF                        csf</span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a><span class="dv">10</span> coronal left  <span class="dv">0028</span>  Left<span class="sc">-</span>VentralDC             ventraldc</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a><span class="co"># … with 96 more rows</span></span></code></pre></div>
<p>Second step is to make sure the data is being plotted correctly.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aseg2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg2_first.png"><!-- --></p>
<p>We can clearly see something is wrong, but the legend indicated that
there is data there we cannot see. Setting the <code>alpha</code> might
expose something.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aseg2</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg2_second.png"><!-- --></p>
<p>We can see that the polygons are there, but they are hidden behind
something. The colour of the polygons indicate that these are
<code>NA</code> values. Inspecting the atlas data directly is a good
idea.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aseg2</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>Simple feature collection with <span class="dv">112</span> features and <span class="dv">5</span> fields</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>geometry type<span class="sc">:</span>  MULTIPOLYGON</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>dimension<span class="sc">:</span>      XY</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>bbox<span class="sc">:</span>           xmin<span class="sc">:</span> <span class="dv">0</span> ymin<span class="sc">:</span> <span class="dv">0</span> xmax<span class="sc">:</span> <span class="fl">578.2364</span> ymax<span class="sc">:</span> <span class="fl">203.3227</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>CRS<span class="sc">:</span>            <span class="cn">NA</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co"># A tibble: 112 x 6</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>   side   hemi  roi                                               geometry label          region</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a> <span class="sc">*</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>  <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                                       <span class="er">&lt;</span>MULTIPOLYGON<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>          <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a> <span class="dv">1</span> coron… <span class="cn">NA</span>    <span class="dv">0000</span>  (((<span class="fl">8.596379</span> <span class="fl">105.0979</span>, <span class="fl">8.532187</span> <span class="fl">105.0767</span>, <span class="fl">8.469717</span> <span class="dv">1</span>… Unknown        <span class="cn">NA</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a> <span class="dv">2</span> coron… left  <span class="dv">0002</span>  (((<span class="fl">82.41844</span> <span class="fl">102.0004</span>, <span class="fl">82.39649</span> <span class="fl">101.9761</span>, <span class="fl">82.37604</span> <span class="dv">1</span>… Left<span class="sc">-</span>Cerebral… cerebral wh…</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a> <span class="dv">3</span> coron… left  <span class="dv">0003</span>  (((<span class="fl">88.86371</span> <span class="fl">171.1159</span>, <span class="fl">88.76302</span> <span class="fl">171.0871</span>, <span class="fl">88.66764</span> <span class="dv">1</span>… Left<span class="sc">-</span>Cerebral… cerebral co…</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a> <span class="dv">4</span> coron… left  <span class="dv">0004</span>  (((<span class="fl">101.7151</span> <span class="fl">116.3753</span>, <span class="fl">101.64</span> <span class="fl">116.3752</span>, <span class="fl">101.5623</span> <span class="dv">116</span>… Left<span class="sc">-</span>Lateral<span class="sc">-</span>… lateral ven…</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a> <span class="dv">5</span> coron… left  <span class="dv">0010</span>  (((<span class="fl">100.0108</span> <span class="fl">100.9053</span>, <span class="fl">99.87905</span> <span class="fl">100.9186</span>, <span class="fl">99.74468</span> <span class="dv">1</span>… Left<span class="sc">-</span>Thalamus… thalamus pr…</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a> <span class="dv">6</span> coron… left  <span class="dv">0012</span>  (((<span class="fl">116.5521</span> <span class="fl">82.86438</span>, <span class="fl">116.5237</span> <span class="fl">82.81094</span>, <span class="fl">116.4955</span> <span class="dv">8</span>… Left<span class="sc">-</span>Putamen   putamen</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a> <span class="dv">7</span> coron… <span class="cn">NA</span>    <span class="dv">0014</span>  (((<span class="fl">78.65921</span> <span class="fl">86.42692</span>, <span class="fl">78.55424</span> <span class="fl">86.38102</span>, <span class="fl">78.45397</span> <span class="dv">8</span>… <span class="dv">3</span>rd<span class="sc">-</span>Ventricle  <span class="dv">3</span>rd ventric…</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a> <span class="dv">8</span> coron… <span class="cn">NA</span>    <span class="dv">0016</span>  (((<span class="fl">88.73587</span> <span class="fl">62.17754</span>, <span class="fl">88.62459</span> <span class="fl">62.18198</span>, <span class="fl">88.51179</span> <span class="dv">6</span>… Brain<span class="sc">-</span>Stem     brain stem</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a> <span class="dv">9</span> coron… left  <span class="dv">0017</span>  (((<span class="fl">113.3849</span> <span class="fl">67.15476</span>, <span class="fl">113.2684</span> <span class="fl">67.12281</span>, <span class="fl">113.1575</span> <span class="dv">6</span>… Left<span class="sc">-</span>Hippocam… hippocampus</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="dv">10</span> coron… <span class="cn">NA</span>    <span class="dv">0024</span>  (((<span class="fl">78.87844</span> <span class="fl">101.8815</span>, <span class="fl">78.78444</span> <span class="fl">101.8421</span>, <span class="fl">78.69133</span> <span class="dv">1</span>… CSF            csf</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a><span class="co"># … with 102 more rows</span></span></code></pre></div>
<p>We should remove the <code>NA</code> data from the atlas, and also
the white-matter regions, since these don’t really fit in. Additionally,
sub-cortical atlases have the cortex as region <code>NA</code> so that
these are plotted, but not really treated as true parcellation
regions.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aseg2</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">aseg2</span><span class="op">$</span><span class="va">data</span>,</span>
<span>                     <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Unknown"</span>, <span class="va">label</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"White-matter"</span>, <span class="va">label</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cortex"</span>, <span class="va">region</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="va">region</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aseg2</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># aseg subcortical brain atlas</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  regions<span class="sc">:</span> <span class="dv">15</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  hemispheres<span class="sc">:</span> left, <span class="cn">NA</span>, right</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  side views<span class="sc">:</span> coronal, sagittal, axial</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>  palette<span class="sc">:</span> yes</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>  use<span class="sc">:</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_brain</span>()</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="sc">----</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>   side    hemi  roi   label                   region</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                   <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a> <span class="dv">1</span> coronal left  <span class="dv">0004</span>  Left<span class="sc">-</span>Lateral<span class="sc">-</span>Ventricle  lateral ventricle</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a> <span class="dv">2</span> coronal left  <span class="dv">0010</span>  Left<span class="sc">-</span>Thalamus<span class="sc">-</span>Proper    thalamus proper</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a> <span class="dv">3</span> coronal left  <span class="dv">0012</span>  Left<span class="sc">-</span>Putamen            putamen</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a> <span class="dv">4</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0014</span>  <span class="dv">3</span>rd<span class="sc">-</span>Ventricle           <span class="dv">3</span>rd ventricle</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a> <span class="dv">5</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0016</span>  Brain<span class="sc">-</span>Stem              brain stem</span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a> <span class="dv">6</span> coronal left  <span class="dv">0017</span>  Left<span class="sc">-</span>Hippocampus        hippocampus</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a> <span class="dv">7</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0024</span>  CSF                     csf</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a> <span class="dv">8</span> coronal left  <span class="dv">0028</span>  Left<span class="sc">-</span>VentralDC          ventraldc</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a> <span class="dv">9</span> coronal right <span class="dv">0043</span>  Right<span class="sc">-</span>Lateral<span class="sc">-</span>Ventricle lateral ventricle</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a><span class="dv">10</span> coronal right <span class="dv">0049</span>  Right<span class="sc">-</span>Thalamus<span class="sc">-</span>Proper   thalamus proper</span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a><span class="co"># … with 70 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aseg2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg2_complete.png"><!-- --></p>
<p>In most cases, given the values in the 3d-atlas’ <code>colour</code>
column is correctly applied, but problems may arise given how annotation
files are set up.</p>
</div>
<div class="section level3">
<h3 id="fixing-the-palette">Fixing the palette<a class="anchor" aria-label="anchor" href="#fixing-the-palette"></a>
</h3>
<p>Many colour tables have a unique colour for the same regions but in
different hemispheres. This can often mess up the palette for the
2d-atlas, which needs the regions in the different hemispheres to have
the same palette colour.</p>
<p>If you are working with an atlas that does not have a colour-scheme
dispatched with the atlas, the palette should be set to
<code>NULL</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aseg2</span><span class="op">$</span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">aseg2</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co"># aseg subcortical brain atlas</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  regions<span class="sc">:</span> <span class="dv">15</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  hemispheres<span class="sc">:</span> left, <span class="cn">NA</span>, right</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  side views<span class="sc">:</span> coronal, sagittal, axial</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>  palette<span class="sc">:</span> no</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>  use<span class="sc">:</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_brain</span>()</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="sc">----</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>   side    hemi  roi   label                   region</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                   <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a> <span class="dv">1</span> coronal left  <span class="dv">0004</span>  Left<span class="sc">-</span>Lateral<span class="sc">-</span>Ventricle  lateral ventricle</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a> <span class="dv">2</span> coronal left  <span class="dv">0010</span>  Left<span class="sc">-</span>Thalamus<span class="sc">-</span>Proper    thalamus proper</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a> <span class="dv">3</span> coronal left  <span class="dv">0012</span>  Left<span class="sc">-</span>Putamen            putamen</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a> <span class="dv">4</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0014</span>  <span class="dv">3</span>rd<span class="sc">-</span>Ventricle           <span class="dv">3</span>rd ventricle</span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a> <span class="dv">5</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0016</span>  Brain<span class="sc">-</span>Stem              brain stem</span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a> <span class="dv">6</span> coronal left  <span class="dv">0017</span>  Left<span class="sc">-</span>Hippocampus        hippocampus</span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a> <span class="dv">7</span> coronal <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>  <span class="dv">0024</span>  CSF                     csf</span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a> <span class="dv">8</span> coronal left  <span class="dv">0028</span>  Left<span class="sc">-</span>VentralDC          ventraldc</span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a> <span class="dv">9</span> coronal right <span class="dv">0043</span>  Right<span class="sc">-</span>Lateral<span class="sc">-</span>Ventricle lateral ventricle</span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a><span class="dv">10</span> coronal right <span class="dv">0049</span>  Right<span class="sc">-</span>Thalamus<span class="sc">-</span>Proper   thalamus proper</span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a><span class="co"># … with 70 more rows</span></span></code></pre></div>
<p>When there is no palette, the default atlas plot will return with
default ggplot2 colours. This is absolutely a valid option. The palette
is an optional part of the atlas.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aseg2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg2_nocol.png" class="r-plt" alt="" width="90%"></p>
<p>If you want to correctly apply a palette, the
<code>aseg2$palette</code> part of the atlas is a named character
vector, where the value of the vector is the hex-colour code, and the
names of the elements are the region names as seen in the
<code>region</code> column of the atlas data.</p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>All together, the script to create both 3d and 2d atlases of the aseg
parcellation looks like this:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ggseg/ggsegExtra" class="external-link">ggsegExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ggseg/ggseg" class="external-link">ggseg</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make  3d ----</span></span>
<span><span class="va">aseg2_3d</span> <span class="op">&lt;-</span> <span class="fu">make_aseg_2_3datlas</span><span class="op">(</span></span>
<span>  subject <span class="op">=</span> <span class="st">"fsaverage5"</span>,</span>
<span>  subjects_dir <span class="op">=</span> <span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_dir.html" class="external-link">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  template <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_dir.html" class="external-link">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5"</span>, <span class="st">"mri/aseg.mgz"</span><span class="op">)</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"~/Desktop/aseg"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggseg3d/man/ggseg3d.html" class="external-link">ggseg3d</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">aseg2_3d</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make atlas ----</span></span>
<span><span class="va">aseg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_volumetric_ggseg.html">make_volumetric_ggseg</a></span><span class="op">(</span>subject <span class="op">=</span> <span class="st">"fsaverage5"</span>,</span>
<span>                               steps <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,</span>
<span>                               output_dir <span class="op">=</span> <span class="st">"~/Desktop/aseg"</span>,</span>
<span>                               vertex_size_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                               label_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">freesurfer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/freesurfer/man/fs_dir.html" class="external-link">fs_subj_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"fsaverage5"</span>, <span class="st">"mri/aseg.mgz"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aseg2</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">aseg2</span><span class="op">$</span><span class="va">data</span>,</span>
<span>                     <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Unknown"</span>, <span class="va">label</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"White-matter"</span>, <span class="va">label</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cortex"</span>, <span class="va">region</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="va">region</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aseg2</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/aseg2_complete.png"><!-- --></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Athanasia Mo Mowinckel, Didac Vidal-Piñeiro.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
