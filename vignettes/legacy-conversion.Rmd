---
title: "Converting legacy atlases"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Converting legacy atlases}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| label: setup
#| include: false
library(ggsegExtra)
```

If you have atlases from older versions of ggseg or ggseg3d, this vignette explains how to convert them to the current `brain_atlas` format.

```{r}
#| label: load-libraries
#| eval: false
library(ggsegExtra)
library(ggseg3d)
```

## The old system

Previous versions used separate objects for 2D and 3D rendering:

- `ggseg_atlas` objects for 2D plots with ggseg
- `ggseg3d_atlas` objects for 3D plots with ggseg3d

Atlas packages exported pairs like `dk` and `dk_3d`, or `yeo7` and `yeo7_3d`.
You had to remember which object to use with which package.

## The current system

The current system uses a single `brain_atlas` object that works with both packages.
One atlas, both renderers.

## Converting old atlases

Use `unify_legacy_atlases()` to convert old atlas objects:

### From a ggseg3d_atlas only

```{r}
#| label: convert-3d
#| eval: false
unified <- unify_legacy_atlases(atlas_3d = old_atlas_3d)

ggseg3d(atlas = unified)
```

### From both 2D and 3D objects

```{r}
#| label: convert-both
#| eval: false
unified <- unify_legacy_atlases(
  atlas_2d = old_atlas,
  atlas_3d = old_atlas_3d
)

plot(unified)

ggseg3d(atlas = unified)
```

### From a ggseg_atlas only

```{r}
#| label: convert-2d
#| eval: false
unified <- unify_legacy_atlases(atlas_2d = old_atlas)

plot(unified)
```

This atlas works with ggseg but not ggseg3d (no 3D vertex data).

## Specifying atlas type

The function auto-detects atlas type from the structure.
Override if needed:

```{r}
#| label: override-type
#| eval: false
unified <- unify_legacy_atlases(
  atlas_2d = old_atlas,
  atlas_3d = old_atlas_3d,
  atlas_name = "my_atlas",
  type = "cortical"
)
```

Valid types: "cortical", "subcortical", "tract".

## Troubleshooting

**No vertices inferred**: The mesh coordinates don't align with the brain surface.
Check that `surface` matches what was used to create the 3D atlas.

**Wrong hemisphere assignment**: The function infers hemisphere from the `hemi` column.
If this is missing or wrong, set it manually after conversion.

**Type detection fails**: Set `type` explicitly.

## When to recreate instead

Converting works, but recreating from source data produces better results.
Use the creation functions if you have access to the original neuroimaging files:

- `create_cortical_atlas()` --- from FreeSurfer annotation files
- `create_subcortical_atlas()` --- from volumetric segmentation
- `create_tract_atlas()` --- from tractography files
- `create_atlas_from_labels()` --- from individual label files

See the [cortical](tutorial-cortical-atlas.html), [subcortical](tutorial-subcortical-atlas.html), [tract](tutorial-tract-atlas.html), and [label-based](tutorial-label-atlas.html) atlas tutorials.
