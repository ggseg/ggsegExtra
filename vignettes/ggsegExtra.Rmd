---
title: "Using ggsegExtra atlases"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using ggsegExtra atlases}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| label: setup
#| include: false
knitr::opts_chunk$set(
  collapse = TRUE,
  out.width = "100%",
  fig.width = 10
)
```

ggsegExtra does two things: it helps you find and install brain atlases that work with ggseg and ggseg3d, and it provides the tools to create your own atlases from neuroimaging data.

```{r}
#| label: load-pkg
library(ggsegExtra)
```

## Installing atlases

Atlases live in their own packages, distributed through the [ggseg r-universe](https://ggseg.r-universe.dev).

```{r}
#| label: list-repos
ggseg_atlas_repos()
```

Search for specific atlases by name:

```{r}
#| label: search-repos
ggseg_atlas_repos("Yeo")

ggseg_atlas_repos("yeo", ignore.case = TRUE)
```

Install atlases from the ggseg r-universe:

```{r}
#| label: install-atlas
#| eval: false
ggseg_atlas_repos("dkt", ignore.case = TRUE)
install_ggseg_atlas("ggsegDKT")
```

## Plotting with ggseg (2D)

Once installed, atlases work directly with ggseg:

```{r}
#| label: ggseg
#| eval: false
library(ggplot2)
library(ggseg)
library(ggsegDKT)

ggplot() +
  geom_brain(atlas = dkt)
```

Most atlases include colour palettes from their original publications:

```{r}
#| label: ggseg-scale
#| eval: false
ggplot() +
  geom_brain(atlas = dkt) +
  scale_fill_brain("dkt", package = "ggsegDKT")
```

## Plotting with ggseg3d (3D)

The same atlas works with ggseg3d for interactive 3D visualisation:

```{r}
#| label: ggseg3d-example
#| eval: false
library(ggseg3d)

ggseg3d(atlas = dkt) |>
  pan_camera("right lateral")
```

One atlas, both packages.

## Creating your own atlases

ggsegExtra provides four functions to create brain atlases from different input types:

| Function | Input | Use case |
|----------|-------|----------|
| `create_cortical_atlas()` | FreeSurfer annotation files | Cortical parcellations (DKT, aparc, Yeo networks) |
| `create_subcortical_atlas()` | Volumetric segmentation (aseg.mgz) | Subcortical structures (thalamus, amygdala, etc.) |
| `create_tract_atlas()` | Tractography files (TRK, TCK) | White matter tracts |
| `create_atlas_from_labels()` | Individual label files | Custom region combinations |

See the dedicated tutorials for each atlas type:

- [Cortical atlases](cortical-atlas.html) - from annotation files
- [Subcortical atlases](subcortical-atlas.html) - from volumetric segmentation
- [Tract atlases](tract-atlas.html) - from tractography
- [Label-based atlases](label-atlas.html) - from individual label files

All functions produce a `brain_atlas` object that works with both ggseg and ggseg3d.
The atlas contains:

- **Core metadata**: region names, hemisphere, labels
- **Colour palette**: from your input files or auto-generated
- **3D data**: vertex indices (cortical) or meshes (subcortical/tract)
- **2D geometry** (optional): polygon outlines for flat brain plots

## Quick or detailed atlases

Each creation function has an `include_geometry` parameter:

```{r}
#| label: include-geometry
#| eval: false
atlas_3d_only <- create_cortical_atlas(
  annot = "aparc",
  include_geometry = FALSE
)

atlas_full <- create_cortical_atlas(
  annot = "aparc",
  include_geometry = TRUE
)
```

Set `include_geometry = FALSE` when you only need 3D rendering.
This skips the screenshot pipeline and returns almost instantly.
Set it to `TRUE` when you also need 2D polygon plots, which requires FreeSurfer and takes longer.

## System requirements

Creating atlases (as opposed to using pre-built ones) requires:

- [FreeSurfer](https://surfer.nmr.mgh.harvard.edu/) for reading neuroimaging formats
- [ImageMagick](https://imagemagick.org/) for 2D geometry extraction

See `vignette("system_setup")` for installation details and optional parallel processing setup.
