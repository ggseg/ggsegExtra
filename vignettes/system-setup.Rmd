---
title: "System setup"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{System setup}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| label: setup
#| include: false
library(ggseg.extra)
```

Using pre-built atlases requires nothing beyond R.
Creating your own atlases requires external software.
This vignette covers what you need and how to set it up.

## FreeSurfer

[FreeSurfer](https://surfer.nmr.mgh.harvard.edu/fswiki/DownloadAndInstall) handles neuroimaging file formats and provides the surface reconstruction tools that atlas creation depends on.

On macOS, you also need:

- [XQuartz](https://www.xquartz.org/)
- [Xcode](https://developer.apple.com/xcode/) command line tools

Verify your installation:

```{r}
#| label: check-fs
#| eval: false
freesurfer::fs_dir()
```

## ImageMagick

[ImageMagick](https://imagemagick.org/) handles the image processing steps in the 2D geometry pipeline --- isolating regions from screenshots, tracing contours, and converting them to polygons.

Install via your package manager:

```bash
# macOS
brew install imagemagick

# Ubuntu/Debian
sudo apt-get install imagemagick
```

## Chrome / Chromium

ggseg.extra takes screenshots of 3D visualisations using the webshot2 package, which needs Google Chrome or Chromium.
Chrome is typically already installed.
If not, chromote will attempt to download a suitable version automatically.

## Parallel processing

Atlas creation can be slow, especially for cortical atlases with many regions.
ggseg.extra uses the [furrr](https://furrr.futureverse.org/) package for parallel processing.
By default, processing runs sequentially.

To enable parallel processing, set up a `future` plan before running atlas creation functions:

```{r}
#| label: parallel
#| eval: false
library(future)

plan(multicore, workers = 4)
```

`multicore` uses forking, which shares memory and avoids serializing large
volumes to each worker.
On Windows where forking is not supported, use `plan(multisession)` instead.

To return to sequential processing:

```{r}
#| label: sequential
#| eval: false
plan(sequential)
```

## Progress bars

ggseg.extra uses [progressr](https://progressr.futureverse.org/) to report progress during long-running operations.
Progress reporting is disabled by default.

To enable progress bars:

```{r}
#| label: progress
#| eval: false
library(progressr)

handlers("cli")
handlers(global = TRUE)
```

This gives you a cli-style progress bar that updates as each region or step completes.
It works with both sequential and parallel execution.

## Checking your setup

Run the setup report to verify everything is in place:

```{r}
#| label: sitrep
#| eval: false
setup_sitrep()
```
