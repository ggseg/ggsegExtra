% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/atlas-tracts.R
\name{create_tract_atlas}
\alias{create_tract_atlas}
\title{Create brain atlas from white matter tracts}
\usage{
create_tract_atlas(
  input_tracts,
  input_aseg = NULL,
  tract_names = NULL,
  colours = NULL,
  tube_radius = 5,
  tube_segments = 8,
  centerline_method = c("mean", "medoid"),
  n_points = 50,
  density_radius_range = c(0.2, 1),
  verbose = NULL,
  views = NULL,
  cortex_slices = NULL,
  output_dir = tempdir(),
  tract_radius = 3,
  cortex_labels = NULL,
  coords_are_voxels = NULL,
  smoothness = NULL,
  tolerance = NULL,
  cleanup = NULL,
  skip_existing = NULL,
  steps = NULL
)
}
\arguments{
\item{input_tracts}{Paths to tractography files (\code{.trk} or \code{.tck}), or a
named list of coordinate matrices where each matrix has N rows and 3
columns (x, y, z).}

\item{input_aseg}{Path to a segmentation volume (\code{.mgz}, \code{.nii}) used to
draw cortex outlines in 2D views. Required when running step 2.}

\item{tract_names}{Names for each tract. If NULL and \code{input_tracts} are
file paths, names are derived from filenames.}

\item{colours}{Colours for each region/structure. If NULL, assigns colours
from a rainbow palette.}

\item{tube_radius}{Controls the tube thickness. Either a single numeric
value for uniform radius, or \code{"density"} to scale radius by how many
streamlines pass through each point.}

\item{tube_segments}{Number of segments around the tube circumference.
Higher values make smoother tubes but larger meshes. Default 8 is a
good balance.}

\item{centerline_method}{How to extract the centerline from multiple
streamlines: \code{"mean"} averages coordinates point-by-point, \code{"medoid"}
selects the single most representative streamline.}

\item{n_points}{Number of points to resample the centerline to. All tracts
are resampled to this length for consistent tube generation.}

\item{density_radius_range}{When \code{tube_radius = "density"}, the minimum
and maximum radius values. Default \code{c(0.2, 1.0)}.}

\item{verbose}{Control verbosity. If not specified, uses the value from
\code{options("ggsegExtra.verbosity")} or the \code{GGSEGEXTRA_VERBOSITY}
environment variable. Can be:
\itemize{
\item \code{TRUE} or \code{1}: Normal verbosity (default)
\item \code{FALSE} or \code{0}: Silent
\item \code{2}: High verbosity (includes FreeSurfer verbose output)
Use \code{\link[=set_verbosity]{set_verbosity()}} to change the default globally.
}}

\item{views}{A data.frame specifying projection views. See
\code{\link[=create_tract_geometry_volumetric]{create_tract_geometry_volumetric()}} for format details.}

\item{cortex_slices}{A data.frame specifying cortex slice positions for
2D views. See \code{\link[=create_tract_geometry_volumetric]{create_tract_geometry_volumetric()}} for format details.}

\item{output_dir}{Directory to store intermediate files (screenshots, masks,
contours). Defaults to \code{\link[=tempdir]{tempdir()}}.}

\item{tract_radius}{Dilation radius when rasterising tract coordinates
to voxels for 2D projection.}

\item{cortex_labels}{Named list with \code{"left"} and \code{"right"} vectors of
label values identifying cortical voxels in the segmentation. If NULL,
auto-detects from aparc+aseg or aseg labels.}

\item{coords_are_voxels}{If TRUE, streamline coordinates are already in
voxel space (0-indexed). If FALSE, coordinates are in RAS (world) space
and will be transformed. If NULL (default), auto-detects by checking
coordinate ranges.}

\item{smoothness}{Smoothing factor for 2D contours. Higher values produce
smoother region boundaries. Passed to \code{\link[smoothr:smooth]{smoothr::smooth()}}. If not
specified, uses \code{options("ggsegExtra.smoothness")} or the
\code{GGSEGEXTRA_SMOOTHNESS} environment variable. Default is 5.}

\item{tolerance}{Simplification tolerance for 2D polygons. Higher values
produce simpler shapes with fewer vertices. Passed to \code{\link[sf:geos_unary]{sf::st_simplify()}}.
If not specified, uses \code{options("ggsegExtra.tolerance")} or the
\code{GGSEGEXTRA_TOLERANCE} environment variable. Default is 0 (no simplification).}

\item{cleanup}{Remove intermediate files after atlas creation. If not
specified, uses \code{options("ggsegExtra.cleanup")} or the \code{GGSEGEXTRA_CLEANUP}
environment variable. Default is TRUE.}

\item{skip_existing}{Skip generating output files that already exist,
allowing interrupted atlas creation to resume. If not specified, uses
\code{options("ggsegExtra.skip_existing")} or the \code{GGSEGEXTRA_SKIP_EXISTING}
environment variable. Default is TRUE.}

\item{steps}{Which pipeline steps to run. Default NULL runs all steps.
Steps are:
\itemize{
\item 1: Read tractography and create tube meshes
\item 2: Create 2D projection geometry
}
Use \code{steps = 1} for 3D-only atlas.}
}
\value{
A \code{brain_atlas} object with type \code{"tract"}, containing region
metadata, tube meshes for 3D rendering, colours, and optionally sf
geometry for 2D projection plots.
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}

Turn tractography streamlines into a brain atlas where each tract is
rendered as a 3D tube. The function computes a centerline from the
streamlines and generates a tube mesh around it.

You can provide tract data in several formats: TRK files from TrackVis,
TCK files from MRtrix, or coordinate matrices directly in R. The function
reads the streamlines, extracts a representative centerline (by averaging
or selecting the medoid), and builds a tube mesh for 3D rendering.

For tracts with many streamlines, set \code{tube_radius = "density"} to make
the tube thicker where more streamlines pass through.
}
\examples{
\dontrun{
# From TRK files
atlas <- create_tract_atlas(
  input_tracts = c("cst_left.trk", "cst_right.trk"),
  tract_names = c("CST left", "CST right")
)

# From coordinate matrices
centerlines <- list(
  cst_left = matrix(rnorm(150), ncol = 3),
  cst_right = matrix(rnorm(150), ncol = 3)
)
atlas <- create_tract_atlas(input_tracts = centerlines)

# View with ggseg3d
ggseg3d(atlas = atlas)
}
}
