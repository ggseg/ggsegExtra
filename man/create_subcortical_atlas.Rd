% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/atlas-subcortical.R
\name{create_subcortical_atlas}
\alias{create_subcortical_atlas}
\title{Create brain atlas from subcortical segmentation}
\usage{
create_subcortical_atlas(
  input_volume,
  input_lut = NULL,
  atlas_name = NULL,
  views = NULL,
  output_dir = tempdir(),
  vertex_size_limits = NULL,
  dilate = NULL,
  tolerance = NULL,
  smoothness = NULL,
  verbose = NULL,
  cleanup = NULL,
  skip_existing = NULL,
  steps = NULL
)
}
\arguments{
\item{input_volume}{Path to the segmentation volume. Supports \code{.mgz}, \code{.nii},
and \code{.nii.gz} formats. Typically this is \code{aseg.mgz} or a custom
segmentation in the same space.}

\item{input_lut}{Path to a FreeSurfer-style colour lookup table that maps
label IDs to region names and colours (e.g., \code{FreeSurferColorLUT.txt}
or \code{ASegStatsLUT.txt}). If NULL, generates a colour table from the
volume labels using rainbow colours. Region names will be generic
(e.g., "region_0010").}

\item{atlas_name}{Name for the atlas. If NULL, derived from the input
filename.}

\item{views}{A data.frame specifying projection views with columns \code{name},
\code{type} ("axial", "coronal", "sagittal"), \code{start} (first slice), \code{end}
(last slice). Default projects entire volume from each direction.
Unlike slices, projections show ALL structures in their spatial
relationships - like an X-ray view.}

\item{output_dir}{Directory to store intermediate files (screenshots, masks,
contours). Defaults to \code{\link[=tempdir]{tempdir()}}.}

\item{vertex_size_limits}{Numeric vector of length 2 setting minimum and
maximum vertex count for polygons. Polygons outside this range are
filtered out. Default NULL applies no limits.}

\item{dilate}{Dilation iterations for 2D polygons. Useful for filling small
gaps between structures.}

\item{tolerance}{Simplification tolerance for 2D polygons. Higher values
produce simpler shapes with fewer vertices. Passed to \code{\link[sf:geos_unary]{sf::st_simplify()}}.
If not specified, uses \code{options("ggsegExtra.tolerance")} or the
\code{GGSEGEXTRA_TOLERANCE} environment variable. Default is 0 (no simplification).}

\item{smoothness}{Smoothing factor for 2D contours. Higher values produce
smoother region boundaries. Passed to \code{\link[smoothr:smooth]{smoothr::smooth()}}. If not
specified, uses \code{options("ggsegExtra.smoothness")} or the
\code{GGSEGEXTRA_SMOOTHNESS} environment variable. Default is 5.}

\item{verbose}{Control verbosity. If not specified, uses the value from
\code{options("ggsegExtra.verbosity")} or the \code{GGSEGEXTRA_VERBOSITY}
environment variable. Can be:
\itemize{
\item \code{TRUE} or \code{1}: Normal verbosity (default)
\item \code{FALSE} or \code{0}: Silent
\item \code{2}: High verbosity (includes FreeSurfer verbose output)
Use \code{\link[=set_verbosity]{set_verbosity()}} to change the default globally.
}}

\item{cleanup}{Remove intermediate files after atlas creation. If not
specified, uses \code{options("ggsegExtra.cleanup")} or the \code{GGSEGEXTRA_CLEANUP}
environment variable. Default is TRUE.}

\item{skip_existing}{Skip generating output files that already exist,
allowing interrupted atlas creation to resume. If not specified, uses
\code{options("ggsegExtra.skip_existing")} or the \code{GGSEGEXTRA_SKIP_EXISTING}
environment variable. Default is TRUE.}

\item{steps}{Which pipeline steps to run. Default NULL runs all steps.
Steps are:
\itemize{
\item 1: Extract labels from volume and get colour table
\item 2: Create meshes for each structure
\item 3: Build atlas data (3D only if stopping here)
\item 4: Create projection snapshots
\item 5: Process images
\item 6: Extract contours
\item 7: Smooth contours
\item 8: Reduce vertices
\item 9: Build final atlas with 2D geometry
}
Use \code{steps = 1:3} for 3D-only atlas. Use \code{steps = 7:8} to iterate on
smoothing and reduction parameters.}
}
\value{
A \code{brain_atlas} object with region metadata (core), 3D meshes,
a colour palette, and optionally sf geometry for 2D slice plots.
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}

Turn a subcortical segmentation volume (like \code{aseg.mgz}) into a brain
atlas with 3D meshes for each structure. The function extracts each labelled
region from the volume, creates a surface mesh, and smooths it.

For 2D plotting, the function can also generate slice views by taking
snapshots at specified coordinates and extracting contours.

Requires FreeSurfer for mesh generation.
}
\examples{
\dontrun{
# Create 3D-only subcortical atlas from aseg
atlas <- create_subcortical_atlas(
  input_volume = "path/to/aseg.mgz",
  input_lut = "path/to/FreeSurferColorLUT.txt",
  steps = 1:3
)

# View with ggseg3d
ggseg3d(atlas = atlas, hemisphere = "subcort")

# Full atlas with 2D slices
atlas <- create_subcortical_atlas(
  input_volume = "path/to/aseg.mgz",
  input_lut = "path/to/ASegStatsLUT.txt"
)

# Post-process to remove/modify regions
atlas <- atlas |>
  atlas_remove_regions("White-Matter") |>
  atlas_set_context("Cortex")
}
}
