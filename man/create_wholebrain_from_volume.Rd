% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/atlas-wholebrain.R
\name{create_wholebrain_from_volume}
\alias{create_wholebrain_from_volume}
\title{Create atlas from whole-brain volumetric parcellation}
\usage{
create_wholebrain_from_volume(
  input_volume,
  input_lut = NULL,
  atlas_name = NULL,
  output_dir = NULL,
  projfrac = 0.5,
  projfrac_range = c(0, 1, 0.1),
  subject = "fsaverage5",
  regheader = TRUE,
  min_vertices = 50L,
  cortical_labels = NULL,
  subcortical_labels = NULL,
  cortical_views = c("lateral", "medial"),
  subcortical_views = NULL,
  decimate = 0.5,
  tolerance = NULL,
  smoothness = NULL,
  cleanup = NULL,
  verbose = get_verbose(),
  skip_existing = NULL,
  steps = NULL
)
}
\arguments{
\item{input_volume}{Path to volumetric parcellation in MNI152 space
(.mgz, .nii, .nii.gz).}

\item{input_lut}{Path to FreeSurfer-style colour lookup table, or a
data.frame with columns \code{idx}, \code{label}, \code{R}, \code{G}, \code{B}, \code{A}.
If NULL, generic names and no palette.}

\item{atlas_name}{Name for the atlas. If NULL, derived from the input
filename.}

\item{output_dir}{Directory to store intermediate files (screenshots, masks,
contours). Defaults to \code{\link[=tempdir]{tempdir()}}.}

\item{projfrac}{Cortical depth fraction for projection (0 = white surface,
1 = pial surface). Only used when \code{projfrac_range} is NULL. Default 0.5.}

\item{projfrac_range}{Numeric vector \code{c(min, max, delta)} for multi-depth
projection via \code{mri_vol2surf --projfrac-max}. Samples at multiple cortical
depths and takes the maximum label value at each vertex, giving much better
surface coverage than single-depth projection. Default \code{c(0, 1, 0.1)}.
Set to NULL to use single-depth \code{projfrac} instead.}

\item{subject}{Target surface subject. Default "fsaverage5".}

\item{regheader}{If TRUE (default), assumes volume RAS coordinates match
the subject space and uses \code{--regheader}. Works well for standard
MNI152-space volumes. If FALSE, uses FreeSurfer's \code{--mni152reg}
registration (may produce noisy results due to surf2surf resampling).}

\item{min_vertices}{Minimum total vertex count across hemispheres for a
label to be classified as cortical. Default 50.}

\item{cortical_labels}{Character vector of label names to force as cortical.}

\item{subcortical_labels}{Character vector of label names to force as
subcortical.}

\item{cortical_views}{Views for cortical sub-pipeline.
Default \code{c("lateral", "medial")}.}

\item{subcortical_views}{Views for subcortical sub-pipeline. Default NULL
(auto-detected).}

\item{decimate}{Mesh decimation ratio for subcortical meshes (0-1).
Default 0.5.}

\item{tolerance}{Simplification tolerance for 2D polygons. Higher values
produce simpler shapes with fewer vertices. Passed to \code{\link[sf:geos_unary]{sf::st_simplify()}}.
If not specified, uses \code{options("ggseg.extra.tolerance")} or the
\code{GGSEG_EXTRA_TOLERANCE} environment variable. Default is 0 (no simplification).}

\item{smoothness}{Smoothing factor for 2D contours. Higher values produce
smoother region boundaries. Passed to \code{\link[smoothr:smooth]{smoothr::smooth()}}. If not
specified, uses \code{options("ggseg.extra.smoothness")} or the
\code{GGSEG_EXTRA_SMOOTHNESS} environment variable. Default is 5.}

\item{cleanup}{Remove intermediate files after atlas creation. If not
specified, uses \code{options("ggseg.extra.cleanup")} or the \code{GGSEG_EXTRA_CLEANUP}
environment variable. Default is TRUE.}

\item{verbose}{Logical. If not specified, uses the value from
\code{options("ggseg.extra.verbose")} or the \code{GGSEG_EXTRA_VERBOSE}
environment variable. Defaults to \code{TRUE}.
Use \code{options(ggseg.extra.verbose = FALSE)} to suppress output globally.}

\item{skip_existing}{Skip generating output files that already exist,
allowing interrupted atlas creation to resume. If not specified, uses
\code{options("ggseg.extra.skip_existing")} or the \code{GGSEG_EXTRA_SKIP_EXISTING}
environment variable. Default is TRUE.}

\item{steps}{Which pipeline steps to run. Default NULL runs all steps.
Steps are:
\itemize{
\item 1: Project volume onto surface
\item 2: Split labels into cortical/subcortical
\item 3: Run cortical pipeline
\item 4: Run subcortical pipeline
}
Use \code{steps = 1:2} to run projection and split only.}
}
\value{
A named list with elements \code{cortical} and \code{subcortical}, each a
\code{ggseg_atlas} object (or NULL if no regions of that type exist).
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}

Build a brain atlas from a volumetric parcellation (NIfTI/MGZ) that
contains both cortical and subcortical regions. Cortical regions are
projected onto the fsaverage5 surface via FreeSurfer's \code{mri_vol2surf}
and rendered as surface views, while subcortical regions go through
the mesh-based subcortical pipeline.

The function automatically classifies regions as cortical or subcortical
based on vertex coverage on the surface projection, or you can manually
specify the split via \code{cortical_labels} and \code{subcortical_labels}.

Requires FreeSurfer.
}
\examples{
\dontrun{
# Create from MNI152-space NIfTI with LUT
result <- create_wholebrain_from_volume(
  input_volume = "shen_268.nii.gz",
  input_lut = "shen_268_LUT.txt",
  atlas_name = "shen268"
)
result$cortical   # surface-based cortical atlas
result$subcortical # mesh-based subcortical atlas

# Projection + split only (inspect classification)
result <- create_wholebrain_from_volume(
  input_volume = "atlas.nii.gz",
  input_lut = "atlas_LUT.txt",
  steps = 1:2
)
}
}
