<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contributing: creating new tridimensional ggseg3d-atlases • ggsegExtra</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Contributing: creating new tridimensional ggseg3d-atlases">
<meta property="og:description" content="ggsegExtra">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggsegExtra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggsegExtra.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/customatlas.html">Contributing: creating new polygon ggseg-atlases</a>
    </li>
    <li>
      <a href="../articles/customatlas3d.html">Contributing: creating new tridimensional ggseg3d-atlases</a>
    </li>
    <li>
      <a href="../articles/ggsegrepo.html">Contribute: prepare a repository for the atlas</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/LCBC-UiO/ggsegExtra/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="customatlas3d_files/header-attrs-2.1.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Contributing: creating new tridimensional ggseg3d-atlases</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LCBC-UiO/ggsegExtra/blob/master/vignettes/customatlas3d.Rmd"><code>vignettes/customatlas3d.Rmd</code></a></small>
      <div class="hidden name"><code>customatlas3d.Rmd</code></div>

    </div>

    
    
<p>New ggseg3d-atlases can be obtained by converting surfaces into tridimensional meshes in <code>.ply</code> format. The pipeline for creating cortical surfaces and volumetric images into ggseg3d-atlases is slightly different than for ggseg-atlases.</p>
<p>One has to convert the images with information on your labels to a Freesurfer annotation file (cortical) or to a <code>.mgz</code> file (subcortical), and then run an R-function calling Freesurfer and FSL to create the ggseg3d-atlas.</p>
<p>The conversion is based on the scripts available in <a href="https://github.com/andersonwinkler/areal" class="uri">https://github.com/andersonwinkler/areal</a> by Anderson Winkler. Essentially, the functions are identical to A. Winkler’s work, with small edits to better adapt to the R and the specific purpose of ggseg3d-atlas creation. All credit goes to Anderson Winkler for making these pipelines, see more information on his <a href="https://brainder.org/research/brain-for-blender/">webpage</a>.</p>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<ul>
<li>
<a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/">FSL</a><br>
</li>
<li>
<a href="https://surfer.nmr.mgh.harvard.edu/">FreeSurfer</a><br>
</li>
<li><a href="https://www.r-project.org/">R</a></li>
</ul>
<p>These functions will not work on Windows systems, as Freesurfer is not available for Windows. If you desperately need to use it on Windows-bases systems, you can look into Freesurfer docker containers and see if you can connect that to R, but we have not tried this. Finally one has to have R and the ggseg-family of packages to convert the <code>.ply</code> meshes into a ggseg3d-atlas.</p>
</div>
<div id="from-a-surface-image-" class="section level2">
<h2 class="hasAnchor">
<a href="#from-a-surface-image-" class="anchor"></a>From a surface image.</h2>
<div id="make-annotation-file-bash-freesurfer" class="section level3">
<h3 class="hasAnchor">
<a href="#make-annotation-file-bash-freesurfer" class="anchor"></a>1) Make annotation file (bash + Freesurfer)</h3>
<p>Atlases already available in Freesurfer have annotation files, making this step unnecessary. These can be found in the Freesufer subject directory, within a subject in the <code>label/</code> folder, look for files ending with <code>.annot</code>. For other files (like results from your vertex-vise analyses etc), you will need to convert the ROIs you have to annotation files. This may require any of the following conversions:</p>
<ol style="list-style-type: decimal">
<li>Convert overlay files into annotations. (e.g. overlay results to annotations)<br>
</li>
<li>Downsample annotation files (e.g.from fsaverage to fsaverage5)<br>
</li>
<li>Register files across different subject templates (from 164k_FS_LR [HCP] to fsaverage 5).
<ul>
<li>The specific procedure will depend on your original image<br>
</li>
<li>FreeSurfer’s <code>mri_surf2annot</code>, <code>mri_surf2surf</code>, <code>mri_label2annot</code> or <code>mri_surfcluster</code>, should be capable to do most of the required conversions</li>
</ul>
</li>
</ol>
</div>
<div id="run-make_aparc_2_3datlasr" class="section level3">
<h3 class="hasAnchor">
<a href="#run-make_aparc_2_3datlasr" class="anchor"></a>2) Run <code>make_aparc_2_3datlas()</code>(R)</h3>
<p>This script converts your annotations (<code>.annot</code>) into tridimensional (<code>.ply</code>) meshes, and then to a ggseg3d-atlas. Without any arguments, it will create the aparc (Desikan-Killany atlas), based on annotation files in the Freesurfer subejcts directory.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Desikan-Killany atlas (a.k.a aparc)</span>
<span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_aparc_2_3datlas.html">make_aparc_2_3datlas</a></span>()

<span class="co"># Desterieux atlas</span>
<span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_aparc_2_3datlas.html">make_aparc_2_3datlas</a></span>(<span class="kw">annot</span> <span class="kw">=</span> <span class="st">"aparc.a2009s"</span>)

<span class="co"># Yeo 7 networks atlas</span>
<span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_aparc_2_3datlas.html">make_aparc_2_3datlas</a></span>(<span class="kw">annot</span> <span class="kw">=</span> <span class="st">"Yeo2011_7Networks_N1000"</span>)</pre></body></html></div>
<p>Depending on the set-up you have, where you are storing data, etc. you have many arguments to the function to choose from. The arguments for the function are:</p>
<ul>
<li>
<code>annot</code> : annotation base name, “aparc” default<br>
</li>
<li>
<code>subject</code> : Freesufer subject, “fsaverage5” default<br>
</li>
<li>
<code>hemisphere</code> : hemisphere(s), c(“rh”, “lh”) default<br>
</li>
<li>
<code>surface</code> : surfaces to create atlas from, c(“inflated”, “LCBC”, “white”) default<br>
</li>
<li>
<code>subjects_dir</code> : path to Freesurfer $SUBJECTS_DIR, freesurfer::fs_subj_dir() default<br>
</li>
<li>
<code>annot_dir</code> : directory where the annot files are, file.path(subjects_dir, subject, “label”) default<br>
</li>
<li>
<code>output_dir</code> : output directory for intermediary files, tempdir() default<br>
</li>
<li>
<code>cleanup</code> : logical if output directory intermediary files should be deleted at completion, TRUE default<br>
</li>
<li>
<code>verbose</code> : logical to be verbose or not, TRUE (default)</li>
</ul>
<p>Depending on what you need to do, and which folders you may have write-access for on your system, any of these might need changing. You can use any surface already existing in the subjects surf folder. If you have made your own custom annotation file, and placed it on the Desktop, with the names “lh.myResults.annot” and “rh.myResults.annot”, you can use this file doing:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># myResults atlas</span>
<span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_aparc_2_3datlas.html">make_aparc_2_3datlas</a></span>(<span class="kw">annot</span> <span class="kw">=</span> <span class="st">"myResults"</span>,
                       <span class="kw">annot_dir</span> <span class="kw">=</span> <span class="st">"~/Desktop"</span>)</pre></body></html></div>
<p><strong>Note</strong> that the “LCBC” surface only works for subject “fsaverage5”, if you want any other subject, you will need to convert it with <code>freesurfer::mri_surf2srf()</code>. If you want to make your own specialized surface, you can, but you should look into Freesurfer documentation to do that.</p>
<p>You will notice that the <code>atlas</code> column taked directly the name of the annot file, and that the <code>region</code> and <code>label</code> columns are the same. If you are in the process of making an atlas contribution, there are a couple steps necessary for the atlas to be included.</p>
<ol style="list-style-type: decimal">
<li>atlas-name should be short and easily recognisable<br>
</li>
<li>the <code>atlas</code> column should have the same name as the atlas object it self<br>
</li>
<li>contents in the <code>region</code> column should be cleaned to have proper names, <em>not</em> the label names. This is to make it nicer when plotting and make the regions more human readable. Please take care in this step.</li>
</ol>
</div>
</div>
<div id="from-a-volume-image" class="section level2">
<h2 class="hasAnchor">
<a href="#from-a-volume-image" class="anchor"></a>From a volume image</h2>
<div id="create-volumetric-image-bash-freesurfer-fsl" class="section level3">
<h3 class="hasAnchor">
<a href="#create-volumetric-image-bash-freesurfer-fsl" class="anchor"></a>1) Create volumetric image (bash + Freesurfer / FSL)</h3>
<p>The image needs to have the following characteristics:</p>
<ol style="list-style-type: decimal">
<li>Be in MNI305; 2mm FreeSurfer space<br>
</li>
<li>Consists of integer values, in which each integer reflects a different ROI
<ul>
<li>One will have to perform basic transformations (mostly thresholding, binarizing and, registration) with neuroimaging software tools like Freesurfer and FSL.</li>
<li>The specific process will depend on the initial information, but one should manage to convert the data using the following functions: <code>fslmaths</code> (FSL) and <code>mri_convert</code>, <code>mri_vol2vol</code>, <code>mris_calc</code> (FreeSurfer).</li>
<li>The resulting template file must be in Freesurfer<code>.mgz</code> format.</li>
</ul>
</li>
</ol>
</div>
<div id="run-make_aseg_2_3datlas-r" class="section level3">
<h3 class="hasAnchor">
<a href="#run-make_aseg_2_3datlas-r" class="anchor"></a>2) Run <code>make_aseg_2_3datlas()</code> (R)</h3>
<p>This script converts your template images (<code>.mgz</code>) into tridimensional (<code>.ply</code>) meshes, and then to a ggseg3d-atlas. Without any arguments, it will create the aseg atlas, based on <code>mri/aseg.mgz</code> file in the Freesurfer subjects directory, together with the “ASegStatsLUT.txt” file from the Freesurfer main directory.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># aseg atlas (a.k.a aseg)</span>
<span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_aseg_2_3datlas.html">make_aseg_2_3datlas</a></span>()</pre></body></html></div>
<p>Depending on the set-up you have, where you are storing data, etc. you have many arguments to the function to choose from. The arguments for the function are:</p>
<ul>
<li>
<code>template</code> : path to the template.mgz file</li>
<li>
<code>color_lut</code> : path to color LUT, or a data.frame with color LUT (ctab) properties</li>
<li>
<code>steps</code> : there are 5 steps in the transformation, if partial transformation has been done before, and there has been no <code>cleanup</code>, then you can skip the steps already run.</li>
<li>
<code>subject</code> : Freesufer subject, “fsaverage5” default<br>
</li>
<li>
<code>subjects_dir</code> : path to Freesurfer $SUBJECTS_DIR, freesurfer::fs_subj_dir() default<br>
</li>
<li>
<code>output_dir</code> : output directory for intermediary files, tempdir() default<br>
</li>
<li>
<code>cleanup</code> : logical if output directory intermediary files should be deleted at completion, TRUE default<br>
</li>
<li>
<code>verbose</code> : logical to be verbose or not, TRUE (default)</li>
</ul>
<p>Depending on what you need to do, and which folders you may have write-access for on your system, any of these might need changing. You will need to make sure you have a <code>template.mgz</code> file made in 1) before you can run this.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="co"># myResults template without a color LUT</span>
<span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_aparc_2_3datlas.html">make_aparc_2_3datlas</a></span>(<span class="kw">template</span> <span class="kw">=</span> <span class="st">"path/to/myResults.mgz"</span>,
                       <span class="kw">color_lut</span> <span class="kw">=</span> <span class="kw">NULL</span>)

<span class="co"># myResults template with a color LUT</span>
<span class="no">dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_aparc_2_3datlas.html">make_aparc_2_3datlas</a></span>(<span class="kw">template</span> <span class="kw">=</span> <span class="st">"path/to/myResults.mgz"</span>,
                       <span class="kw">color_lut</span> <span class="kw">=</span> <span class="st">"path/to/myResults_LUT.txt"</span>)</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Athanasia Mo Mowinckel, Didac Vidal-Piñeiro.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
